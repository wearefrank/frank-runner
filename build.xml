<project default="restart" xmlns:if="ant:if" xmlns:unless="ant:unless">

	<target name="init">
		<basename property="basedir.basename" file="${basedir}"/>
		<property file="build.properties"/>
		<property name="download.dir" value="download"/>

		<property name="project.dir" value="${main.project}" if:set="sub.project"/>
		<property name="configurations.names" value="${sub.project}" if:set="sub.project"/>

		<property name="modules.dir" value="configurations" if:set="module.dir"/>
		<property name="configurations.names" value="${module.dir}" if:set="module.dir"/>

		<property name="projects.dir" value="${basedir}/.."/>
		<property name="project.dir" value="${basedir.basename}/examples/Frank2Example1"/>
		<available property="project.dir.available" file="${projects.dir}/${project.dir}"/>
		<property file="${projects.dir}/${project.dir}/frank-runner.properties"/>

		<available property="application.war.pom.xml.available" file="${projects.dir}/${project.dir}/application/war/pom.xml"/>
		<property name="war.dir" value="application/war" if:set="application.war.pom.xml.available"/>
		<property name="war.dir" value="war"/>
		<available property="war.pom.xml.available" file="${projects.dir}/${project.dir}/${war.dir}/pom.xml"/>
		<available property="pom.xml.available" file="${projects.dir}/${project.dir}/pom.xml"/>

		<property name="classes.dir" value="${war.dir}/src/main/resources" if:set="war.pom.xml.available"/>
		<property name="configurations.dir" value="${override.configurations.dir}" if:set="override.configurations.dir"/><!-- Enables CI/CD to choose configurations in frank-runner/build.properties. See https://github.com/wearefrank/ladybug-ff-cypress-test/blob/main/.github/workflows/testing.js.yml -->
		<property name="configurations.dir" value="${war.dir}/src/main/configurations" if:set="war.pom.xml.available"/>
		<property name="java.dir" value="${war.dir}/src/main/java" if:set="war.pom.xml.available"/>
		<property name="tests.dir" value="${war.dir}/src/test/testtool" if:set="war.pom.xml.available"/>
		<property name="context.xml" value="${war.dir}/src/main/webapp/META-INF/context.xml" if:set="war.pom.xml.available"/>
		<property name="maven.exec.dir" value="${projects.dir}/${project.dir}/${war.dir}" if:set="war.pom.xml.available"/>

		<property name="classes.dir" value="src/main/resources" if:set="pom.xml.available"/>
		<property name="configurations.dir" value="src/main/configurations" if:set="pom.xml.available"/>
		<property name="java.dir" value="src/main/java" if:set="pom.xml.available"/>
		<property name="tests.dir" value="src/test/testtool" if:set="pom.xml.available"/>
		<property name="context.xml" value="src/main/webapp/META-INF/context.xml" if:set="pom.xml.available"/>
		<property name="maven.exec.dir" value="${projects.dir}/${project.dir}" if:set="pom.xml.available"/>

		<property name="classes.dir" value="classes"/>
		<property name="configurations.dir" value="configurations"/>
		<property name="java.dir" value="java"/>
		<property name="tests.dir" value="tests"/>
		<property name="context.xml" value="context.xml"/>

		<property name="maven" value="false"/>
		<property name="maven" value="true" if:set="war.pom.xml.available"/>
		<property name="maven" value="true" if:set="pom.xml.available"/>
		<property name="maven.phase" value="compile" if:true="${maven}"/>
		<property name="maven.skip.clean" value="false" if:true="${maven}"/>
		<property name="maven.skip.tests" value="false" if:true="${maven}"/>
		<property name="maven.skip.javadoc" value="false" if:true="${maven}"/>
		<property name="maven.verbose" value="false" if:true="${maven}"/>

		<property name="classloader.type" value="DirectoryClassLoader"/>
		<property name="lib.server.dir" value="lib/server"/>
		<property name="lib.webapp.dir" value="lib/webapp"/>
		<property name="database.type" value="h2"/>
		<property name="dtap.stage" value="LOC"/>
		<property name="otap.stage" value="LOC"/>
		<property file="${projects.dir}/${project.dir}/${classes.dir}/DeploymentSpecifics.properties" prefix="ds.properties."/>
		<property name="instance.name" value="${ds.properties.instance.name}" if:set="ds.properties.instance.name"/>
		<basename property="instance.name" file="${project.dir}"/>
		<lower from="${instance.name}" to="instance.name.lc"/>
		<available property="configuration.name.default" value="${instance.name}" file="${projects.dir}/${project.dir}/${classes.dir}/Configuration.xml"/>
		<property name="ibistesttool.directory" value="${projects.dir}/${project.dir}/${tests.dir}"/>
		<property name="context.path" value="ROOT"/>
		<property name="maxmemory" value="1024M"/>
		<property name="frank-flow.context-path" value="/"/><!-- Frank!Flow 3.0 with F!F 8.2 doesn't need this anymore (2.27.1-20231017.123547 will be used when ff.version is 8.1 or lower) -->

		<condition property="os.windows"><os family="windows"/></condition>
		<condition property="os.linux"><and><os family="unix"/><not><os family="mac"/></not></and></condition>
		<condition property="os.mac"><and><os family="unix"/><os family="mac"/></and></condition>

		<property name="jdk.8.version.minor" value="462"/><!-- https://adoptium.net/temurin/ -->
		<property name="jdk.8.version.patch" value="b08"/>
		<property name="jdk.8.dir.sub" value="jdk8u${jdk.8.version.minor}-${jdk.8.version.patch}"/>
		<property name="jdk.8.dir" value="build/${jdk.8.dir.sub}"/>
		<property name="jdk.8.zip.win" value="OpenJDK8U-jdk_x64_windows_hotspot_8u${jdk.8.version.minor}${jdk.8.version.patch}.zip"/>
		<property name="jdk.8.tar.lin" value="OpenJDK8U-jdk_x64_linux_hotspot_8u${jdk.8.version.minor}${jdk.8.version.patch}.tar"/>
		<property name="jdk.8.tar.mac" value="OpenJDK8U-jdk_x64_mac_hotspot_8u${jdk.8.version.minor}${jdk.8.version.patch}.tar"/>
		<property name="jdk.8.zip.lin" value="${jdk.8.tar.lin}.gz"/>
		<property name="jdk.8.zip.mac" value="${jdk.8.tar.mac}.gz"/>
		<property name="jdk.8.zip" value="${jdk.8.zip.win}" if:true="${os.windows}"/>
		<property name="jdk.8.tar" value="${jdk.8.tar.lin}" if:true="${os.linux}"/>
		<property name="jdk.8.zip" value="${jdk.8.zip.lin}" if:true="${os.linux}"/>
		<property name="jdk.8.tar" value="${jdk.8.tar.mac}" if:true="${os.mac}"/>
		<property name="jdk.8.zip" value="${jdk.8.zip.mac}" if:true="${os.mac}"/>
		<property name="jdk.8.url.win" value="https://github.com/adoptium/temurin8-binaries/releases/download/${jdk.8.dir.sub}/${jdk.8.zip.win}"/>
		<property name="jdk.8.url.lin" value="https://github.com/adoptium/temurin8-binaries/releases/download/${jdk.8.dir.sub}/${jdk.8.zip.lin}"/>
		<property name="jdk.8.url.mac" value="https://github.com/adoptium/temurin8-binaries/releases/download/${jdk.8.dir.sub}/${jdk.8.zip.mac}"/>

		<property name="jdk.11.version.minor" value="0"/>
		<property name="jdk.11.version.patch" value="28"/>
		<property name="jdk.11.version.plus" value="6"/>
		<property name="jdk.11.dir.sub" value="jdk-11.${jdk.11.version.minor}.${jdk.11.version.patch}+${jdk.11.version.plus}"/>
		<property name="jdk.11.dir" value="build/${jdk.11.dir.sub}"/>
		<property name="jdk.11.zip.win" value="OpenJDK11U-jdk_x64_windows_hotspot_11.${jdk.11.version.minor}.${jdk.11.version.patch}_${jdk.11.version.plus}.zip"/>
		<property name="jdk.11.tar.lin" value="OpenJDK11U-jdk_x64_linux_hotspot_11.${jdk.11.version.minor}.${jdk.11.version.patch}_${jdk.11.version.plus}.tar"/>
		<property name="jdk.11.tar.mac" value="OpenJDK11U-jdk_x64_mac_hotspot_11.${jdk.11.version.minor}.${jdk.11.version.patch}_${jdk.11.version.plus}.tar"/>
		<property name="jdk.11.zip.lin" value="${jdk.11.tar.lin}.gz"/>
		<property name="jdk.11.zip.mac" value="${jdk.11.tar.mac}.gz"/>
		<property name="jdk.11.zip" value="${jdk.11.zip.win}" if:true="${os.windows}"/>
		<property name="jdk.11.tar" value="${jdk.11.tar.lin}" if:true="${os.linux}"/>
		<property name="jdk.11.zip" value="${jdk.11.zip.lin}" if:true="${os.linux}"/>
		<property name="jdk.11.tar" value="${jdk.11.tar.mac}" if:true="${os.mac}"/>
		<property name="jdk.11.zip" value="${jdk.11.zip.mac}" if:true="${os.mac}"/>
		<property name="jdk.11.url.win" value="https://github.com/adoptium/temurin11-binaries/releases/download/${jdk.11.dir.sub}/${jdk.11.zip.win}"/>
		<property name="jdk.11.url.lin" value="https://github.com/adoptium/temurin11-binaries/releases/download/${jdk.11.dir.sub}/${jdk.11.zip.lin}"/>
		<property name="jdk.11.url.mac" value="https://github.com/adoptium/temurin11-binaries/releases/download/${jdk.11.dir.sub}/${jdk.11.zip.mac}"/>

		<property name="jdk.17.version.minor" value="0"/>
		<property name="jdk.17.version.patch" value="16"/>
		<property name="jdk.17.version.plus" value="8"/>
		<property name="jdk.17.dir.sub" value="jdk-17.${jdk.17.version.minor}.${jdk.17.version.patch}+${jdk.17.version.plus}"/>
		<property name="jdk.17.dir" value="build/${jdk.17.dir.sub}"/>
		<property name="jdk.17.zip.win" value="OpenJDK17U-jdk_x64_windows_hotspot_17.${jdk.17.version.minor}.${jdk.17.version.patch}_${jdk.17.version.plus}.zip"/>
		<property name="jdk.17.tar.lin" value="OpenJDK17U-jdk_x64_linux_hotspot_17.${jdk.17.version.minor}.${jdk.17.version.patch}_${jdk.17.version.plus}.tar"/>
		<property name="jdk.17.tar.mac" value="OpenJDK17U-jdk_x64_mac_hotspot_17.${jdk.17.version.minor}.${jdk.17.version.patch}_${jdk.17.version.plus}.tar"/>
		<property name="jdk.17.zip.lin" value="${jdk.17.tar.lin}.gz"/>
		<property name="jdk.17.zip.mac" value="${jdk.17.tar.mac}.gz"/>
		<property name="jdk.17.zip" value="${jdk.17.zip.win}" if:true="${os.windows}"/>
		<property name="jdk.17.tar" value="${jdk.17.tar.lin}" if:true="${os.linux}"/>
		<property name="jdk.17.zip" value="${jdk.17.zip.lin}" if:true="${os.linux}"/>
		<property name="jdk.17.tar" value="${jdk.17.tar.mac}" if:true="${os.mac}"/>
		<property name="jdk.17.zip" value="${jdk.17.zip.mac}" if:true="${os.mac}"/>
		<property name="jdk.17.url.win" value="https://github.com/adoptium/temurin17-binaries/releases/download/${jdk.17.dir.sub}/${jdk.17.zip.win}"/>
		<property name="jdk.17.url.lin" value="https://github.com/adoptium/temurin17-binaries/releases/download/${jdk.17.dir.sub}/${jdk.17.zip.lin}"/>
		<property name="jdk.17.url.mac" value="https://github.com/adoptium/temurin17-binaries/releases/download/${jdk.17.dir.sub}/${jdk.17.zip.mac}"/>

		<property name="jdk.21.version.minor" value="0"/>
		<property name="jdk.21.version.patch" value="8"/>
		<property name="jdk.21.version.plus" value="9"/>
		<property name="jdk.21.dir.sub" value="jdk-21.${jdk.21.version.minor}.${jdk.21.version.patch}+${jdk.21.version.plus}"/>
		<property name="jdk.21.dir" value="build/${jdk.21.dir.sub}"/>
		<property name="jdk.21.zip.win" value="OpenJDK21U-jdk_x64_windows_hotspot_21.${jdk.21.version.minor}.${jdk.21.version.patch}_${jdk.21.version.plus}.zip"/>
		<property name="jdk.21.tar.lin" value="OpenJDK21U-jdk_x64_linux_hotspot_21.${jdk.21.version.minor}.${jdk.21.version.patch}_${jdk.21.version.plus}.tar"/>
		<property name="jdk.21.tar.mac" value="OpenJDK21U-jdk_x64_mac_hotspot_21.${jdk.21.version.minor}.${jdk.21.version.patch}_${jdk.21.version.plus}.tar"/>
		<property name="jdk.21.zip.lin" value="${jdk.21.tar.lin}.gz"/>
		<property name="jdk.21.zip.mac" value="${jdk.21.tar.mac}.gz"/>
		<property name="jdk.21.zip" value="${jdk.21.zip.win}" if:true="${os.windows}"/>
		<property name="jdk.21.tar" value="${jdk.21.tar.lin}" if:true="${os.linux}"/>
		<property name="jdk.21.zip" value="${jdk.21.zip.lin}" if:true="${os.linux}"/>
		<property name="jdk.21.tar" value="${jdk.21.tar.mac}" if:true="${os.mac}"/>
		<property name="jdk.21.zip" value="${jdk.21.zip.mac}" if:true="${os.mac}"/>
		<property name="jdk.21.url.win" value="https://github.com/adoptium/temurin21-binaries/releases/download/${jdk.21.dir.sub}/${jdk.21.zip.win}"/>
		<property name="jdk.21.url.lin" value="https://github.com/adoptium/temurin21-binaries/releases/download/${jdk.21.dir.sub}/${jdk.21.zip.lin}"/>
		<property name="jdk.21.url.mac" value="https://github.com/adoptium/temurin21-binaries/releases/download/${jdk.21.dir.sub}/${jdk.21.zip.mac}"/>

		<property name="mvn.jdk.version" value="21"/>
		<property name="tomcat.jdk.default.dir" value="${jdk.21.dir}"/>
		<property name="fr.jdk.dir" value="${jdk.21.dir}"/>
		<property name="fr.jdk.zip.win" value="${jdk.21.zip.win}"/>
		<property name="fr.jdk.zip.lin" value="${jdk.21.zip.lin}"/>
		<property name="fr.jdk.zip.mac" value="${jdk.21.zip.mac}"/>
		<property name="fr.jdk.url.win" value="${jdk.21.url.win}"/>
		<property name="fr.jdk.url.lin" value="${jdk.21.url.lin}"/>
		<property name="fr.jdk.url.mac" value="${jdk.21.url.mac}"/>
		<property name="jdk.lib.jspawnhelper" value="lib/jspawnhelper"/><!-- chmod +x to prevent "error=13, Permission denied" since Java 17 for tasks like java and chmod, see also https://askubuntu.com/questions/1480995/permission-denied-trying-to-start-a-new-process-from-a-java-application-as-root -->
		<property name="jdk.sub.mac" value="Contents/Home"/>

		<property name="ant.version." value="1.10.15"/><!-- extra . because ant.version is a build-in property -->
		<property name="ant.base" value="apache-ant-${ant.version.}-bin"/>
		<property name="ant.zip" value="${ant.base}.zip"/>
		<property name="ant.tar" value="${ant.base}.tar"/>
		<property name="ant.gz" value="${ant.tar}.gz"/>
		<property name="ant.base.url" value="https://archive.apache.org/dist/ant/binaries/"/>
		<property name="ant.zip.url" value="${ant.base.url}${ant.zip}"/>
		<property name="ant.gz.url" value="${ant.base.url}${ant.gz}"/>
		<property name="ant.dir" value="build/apache-ant-${ant.version.}"/>
		<property name="rhino.version.major" value="1"/>
		<property name="rhino.version.minor" value="7"/>
		<property name="rhino.version.patch" value="15"/>
		<property name="rhino.version" value="${rhino.version.major}.${rhino.version.minor}.${rhino.version.patch}"/>
		<property name="rhino.zip" value="rhino-${rhino.version}.zip"/>
		<property name="rhino.zip.url" value="https://github.com/mozilla/rhino/releases/download/Rhino${rhino.version.major}_${rhino.version.minor}_${rhino.version.patch}_Release/${rhino.zip}"/>
		<property name="rhino.dir" value="build/rhino${rhino.version}"/>
		<property name="maven.remark.line1" value="Maven will by default use 1.8 for source and target (independent of Java version being used to run Maven)"/>
		<property name="maven.remark.line2" value="For example java 11 can be specified in the pom.xml of your project by adding property &lt;maven.compiler.release>11&lt;/maven.compiler.release>"/>
		<property name="maven.version" value="3.9.11"/><!-- check whether remark above about 1.8 is still correct, see https://maven.apache.org/plugins/maven-compiler-plugin/ -->
		<property name="maven.base" value="apache-maven-${maven.version}-bin"/>
		<property name="maven.zip" value="${maven.base}.zip"/>
		<property name="maven.tar" value="${maven.base}.tar"/>
		<property name="maven.gz" value="${maven.tar}.gz"/>
		<property name="maven.base.url" value="https://archive.apache.org/dist/maven/maven-3/${maven.version}/binaries/"/>
		<property name="maven.zip.url" value="${maven.base.url}${maven.zip}"/>
		<property name="maven.gz.url" value="${maven.base.url}${maven.gz}"/>
		<property name="maven.dir" value="build/apache-maven-${maven.version}"/>
		<property name="tomcat.9.version.minor" value="0"/>
		<property name="tomcat.9.version.patch" value="109"/><!-- on update: also check these for updates: jms, ojdbc, mssql and pgsql -->
		<property name="tomcat.9.version" value="9.${tomcat.9.version.minor}.${tomcat.9.version.patch}"/>
		<property name="tomcat.9.zip" value="apache-tomcat-${tomcat.9.version}.zip"/>
		<property name="tomcat.9.url" value="https://archive.apache.org/dist/tomcat/tomcat-9/v${tomcat.9.version}/bin/${tomcat.9.zip}"/>
		<property name="tomcat.9.dir" value="build/apache-tomcat-${tomcat.9.version}"/>
		<property name="tomcat.10.version.minor" value="1"/>
		<property name="tomcat.10.version.patch" value="46"/><!-- on update: also check these for updates: jms, ojdbc, mssql and pgsql -->
		<property name="tomcat.10.version" value="10.${tomcat.10.version.minor}.${tomcat.10.version.patch}"/>
		<property name="tomcat.10.zip" value="apache-tomcat-${tomcat.10.version}.zip"/>
		<property name="tomcat.10.url" value="https://archive.apache.org/dist/tomcat/tomcat-10/v${tomcat.10.version}/bin/${tomcat.10.zip}"/>
		<property name="tomcat.10.dir" value="build/apache-tomcat-${tomcat.10.version}"/>
		<property name="tomcat.connector.port" value="80" /><!-- for backwards compatibility (tomcat.port introduced 20220318) -->
		<property name="tomcat.port" value="${tomcat.connector.port}"/>
		<property name="tomcat.secure.port" value="443"/>
		<property name="tomcat.server.port" value="8005"/>
		<property name="eclipse.version" value="2025-09"/><!-- on update, also update eclipse.jre.dir and check if lombok needs updating -->
		<property name="eclipse.jre.dir" value="plugins/org.eclipse.justj.openjdk.hotspot.jre.full.win32.x86_64_21.0.8.v20250724-1412/jre"/>
		<property name="eclipse.file" value="eclipse-jee-${eclipse.version}-R-win32-x86_64" if:true="${os.windows}"/>
		<property name="eclipse.file" value="eclipse-jee-${eclipse.version}-R-linux-gtk-x86_64" if:true="${os.linux}"/>
		<property name="eclipse.file" value="eclipse-jee-${eclipse.version}-R-macosx-cocoa-x86_64" if:true="${os.mac}"/>
		<property name="eclipse.zip" value="${eclipse.file}.zip" if:true="${os.windows}"/>
		<property name="eclipse.zip" value="${eclipse.file}.tar.gz" unless:true="${os.windows}"/>
		<property name="eclipse.tar" value="${eclipse.file}.tar"/>
		<property name="eclipse.url" value="https://ftp.snt.utwente.nl/pub/software/eclipse/technology/epp/downloads/release/${eclipse.version}/R/${eclipse.zip}"/>
		<property name="eclipse.dir" value="build/${eclipse.file}"/>
		<property name="lombok.version" value="1.18.42"/>
		<property name="lombok.jar" value="lombok-${lombok.version}.jar"/>
		<property name="lombok.url" value="https://projectlombok.org/downloads/${lombok.jar}"/>
		<property name="winmerge.version" value="2.16.50.2"/>
		<property name="winmerge.zip" value="winmerge-${winmerge.version}-exe.zip"/>
		<property name="winmerge.url" value="https://github.com/WinMerge/winmerge/releases/download/v${winmerge.version}/${winmerge.zip}"/>
		<property name="winmerge.dir" value="build/winmerge-${winmerge.version}-x64-exe"/>
		<property name="jta.version" value="1.1.1"/><!-- https://central.sonatype.com/artifact/org.apache.geronimo.specs/geronimo-jta_1.1_spec/versions -->
		<property name="jta.jar" value="geronimo-jta_1.1_spec-${jta.version}.jar"/>
		<property name="jta.uninstall.mask" value="geronimo-jta*"/>
		<property name="jta.url" value="https://repo1.maven.org/maven2/org/apache/geronimo/specs/geronimo-jta_1.1_spec/${jta.version}/${jta.jar}"/>
		<property name="activation.version" value="2.1.4"/>
		<property name="activation.jar" value="jakarta.activation-api-${activation.version}.jar"/>
		<property name="activation.uninstall.mask" value="jakarta.activation-api*"/>
		<property name="activation.url" value="https://repo1.maven.org/maven2/jakarta/activation/jakarta.activation-api/${activation.version}/${activation.jar}"/>
		<property name="transaction.version" value="2.0.1"/><!-- https://central.sonatype.com/artifact/jakarta.transaction/jakarta.transaction-api/versions -->
		<property name="transaction.jar" value="jakarta.transaction-api-${transaction.version}.jar"/>
		<property name="transaction.uninstall.mask" value="jakarta.transaction-api*"/>
		<property name="transaction.url" value="https://repo1.maven.org/maven2/jakarta/transaction/jakarta.transaction-api/${transaction.version}/${transaction.jar}"/>
		<property name="jms1.version" value="1.1.1"/><!-- https://central.sonatype.com/artifact/org.apache.geronimo.specs/geronimo-jms_1.1_spec/versions -->
		<property name="jms1.jar" value="geronimo-jms_1.1_spec-${jms1.version}.jar"/>
		<property name="jms1.uninstall.mask" value="geronimo-jms*"/>
		<property name="jms1.url" value="https://repo1.maven.org/maven2/org/apache/geronimo/specs/geronimo-jms_1.1_spec/${jms1.version}/${jms1.jar}"/>
		<property name="jms3.version" value="3.1.0"/><!-- https://central.sonatype.com/artifact/jakarta.jms/jakarta.jms-api/versions -->
		<property name="jms3.jar" value="jakarta.jms-api-${jms3.version}.jar"/>
		<property name="jms3.uninstall.mask" value="jakarta.jms-api*"/>
		<property name="jms3.url" value="https://repo1.maven.org/maven2/jakarta/jms/jakarta.jms-api/${jms3.version}/${jms3.jar}"/>
		<property name="h2v1.version" value="1.4.200"/>
		<property name="h2v1.jar" value="h2-${h2v1.version}.jar"/>
		<property name="h2v1.url" value="https://repo1.maven.org/maven2/com/h2database/h2/${h2v1.version}/${h2v1.jar}"/>
		<property name="h2v1.dir" value="${basedir}/build/h2"/>
		<property name="h2v2.version" value="2.3.232"/> <!-- Version 2.4.240 does not work with the FF!. Type datetime does not work anymore -->
		<property name="h2v2.jar" value="h2-${h2v2.version}.jar"/>
		<property name="h2v2.url" value="https://repo1.maven.org/maven2/com/h2database/h2/${h2v2.version}/${h2v2.jar}"/>
		<property name="h2v2.dir" value="${basedir}/build/h2/v2.2"/><!-- changed v2 to v2.2 on upgrade from 2.1.210 to 2.2.220 to prevent: The write format 2 is smaller than the supported format 3 -->
		<property name="h2v2java8.version" value="2.2.224"/>
		<property name="h2v2java8.jar" value="h2-${h2v2java8.version}.jar"/>
		<property name="h2v2java8.url" value="https://repo1.maven.org/maven2/com/h2database/h2/${h2v2java8.version}/${h2v2java8.jar}"/>
		<property name="h2v2java8.dir" value="${basedir}/build/h2/v2.2"/><!-- changed v2 to v2.2 on upgrade from 2.1.210 to 2.2.220 to prevent: The write format 2 is smaller than the supported format 3 -->
		<property name="ojdbc8.version" value="23.9.0.25.07"/><!-- https://central.sonatype.com/artifact/com.oracle.database.jdbc/ojdbc8/versions -->
		<property name="ojdbc8.jar" value="ojdbc8-${ojdbc8.version}.jar"/>
		<property name="ojdbc8.uninstall.mask" value="ojdbc8-*"/>
		<property name="ojdbc8.url" value="https://repo1.maven.org/maven2/com/oracle/database/jdbc/ojdbc8/${ojdbc8.version}/${ojdbc8.jar}"/>
		<property name="ojdbc11.version" value="23.9.0.25.07"/><!-- https://central.sonatype.com/artifact/com.oracle.database.jdbc/ojdbc11/versions -->
		<property name="ojdbc11.jar" value="ojdbc11-${ojdbc11.version}.jar"/>
		<property name="ojdbc11.uninstall.mask" value="ojdbc11-*"/>
		<property name="ojdbc11.url" value="https://repo1.maven.org/maven2/com/oracle/database/jdbc/ojdbc11/${ojdbc11.version}/${ojdbc11.jar}"/>
		<property name="mssql8.version" value="13.2.0.jre8"/><!-- https://central.sonatype.com/artifact/com.microsoft.sqlserver/mssql-jdbc/versions -->
		<property name="mssql8.jar" value="mssql-jdbc-${mssql8.version}.jar"/>
		<property name="mssql8.uninstall.mask" value="mssql-jdbc-*"/>
		<property name="mssql8.url" value="https://repo1.maven.org/maven2/com/microsoft/sqlserver/mssql-jdbc/${mssql8.version}/${mssql8.jar}"/>
		<property name="mssql11.version" value="13.2.0.jre11"/><!-- https://central.sonatype.com/artifact/com.microsoft.sqlserver/mssql-jdbc/versions -->
		<property name="mssql11.jar" value="mssql-jdbc-${mssql11.version}.jar"/>
		<property name="mssql11.uninstall.mask" value="mssql-jdbc-*"/>
		<property name="mssql11.url" value="https://repo1.maven.org/maven2/com/microsoft/sqlserver/mssql-jdbc/${mssql11.version}/${mssql11.jar}"/>
		<property name="pgsql.version" value="42.7.8"/><!-- https://jdbc.postgresql.org/download/ -->
		<property name="pgsql.jar" value="postgresql-${pgsql.version}.jar"/>
		<property name="pgsql.uninstall.mask" value="postgresql-*"/>
		<property name="pgsql.url" value="https://jdbc.postgresql.org/download/${pgsql.jar}"/>

		<condition property="debug.true"><equals arg1="${debug}" arg2="true"/></condition>

		<antcall target="install.cacerts"><param name="jdk.dir" value="${fr.jdk.dir}"/></antcall><!-- install cacerts here in case jdk is unzipped by bat or sh (get tasks below need cacerts)-->

		<property name="update.strategy" value="latest"/>
		<condition property="update.strategy.is.latest"><equals arg1="${update.strategy}" arg2="latest"/></condition>
		<tstamp><format property="get.metadata.tstamp" pattern="yyyyMMdd-HH"/></tstamp>
		<property name="get.metadata.maxtime" value="10"/>
		<property name="get.metadata.ignoreerrors" value="true"/>
		<mkdir dir="${download.dir}/metadata/"/>

		<condition property="get.metadata"><and><isset property="update.strategy.is.latest"/><not><resourceexists><file file="${download.dir}/metadata/maven-metadata-${get.metadata.tstamp}.txt"/></resourceexists></not><not><isset property="ff.version"/></not><not><equals arg1="${maven}" arg2="true"/></not></and></condition>
		<get src="https://nexus.frankframework.org/repository/public/org/frankframework/frankframework-webapp/maven-metadata.xml" dest="${download.dir}/metadata/maven-metadata-tmp.xml" maxtime="${get.metadata.maxtime}" ignoreerrors="${get.metadata.ignoreerrors}" verbose="on" if:set="get.metadata"/>
		<move file="${download.dir}/metadata/maven-metadata-tmp.xml" tofile="${download.dir}/metadata/maven-metadata.xml" failonerror="false" quiet="true"/>
		<xmlproperty file="${download.dir}/metadata/maven-metadata.xml" if:set="update.strategy.is.latest"/>
		<echo file="${download.dir}/metadata/maven-metadata-${get.metadata.tstamp}.txt" if:set="get.metadata">metadata.versioning.latest=${metadata.versioning.latest}</echo>
		<property name="ff.version" value="${metadata.versioning.latest}" if:set="metadata.versioning.latest" unless:true="${maven}"/><!-- unless:true="${maven} to prevent unnecessary download -->
		<condition property="ff.version" value="9.3.0" unless:true="${maven}"><equals arg1="${update.strategy}" arg2="stable"/></condition><!-- unless:true="${maven} to prevent unnecessary download -->
		<fail message="Property update.strategy has invalid value: ${update.strategy}"><condition><not><or><equals arg1="${update.strategy}" arg2="latest"/><equals arg1="${update.strategy}" arg2="stable"/></or></not></condition></fail>
		<condition property="ff.war" value="ibis-adapterframework-webapp-${ff.version}.war"><matches string="${ff.version}" pattern="^[1-7]\..*$"/></condition>
		<condition property="ff.url" value="https://nexus.frankframework.org/repository/public/org/ibissource/ibis-adapterframework-webapp/${ff.version}/${ff.war}"><matches string="${ff.version}" pattern="^[1-7]\..*$"/></condition>
		<property name="ff.war" value="frankframework-webapp-${ff.version}.war"/>
		<property name="ff.url" value="https://nexus.frankframework.org/repository/public/org/frankframework/frankframework-webapp/${ff.version}/${ff.war}"/>

		<condition property="frankflow.get.metadata"><and><not><resourceexists><file file="${download.dir}/metadata/frank-flow/maven-metadata-${get.metadata.tstamp}.txt"/></resourceexists></not><not><isset property="frankflow.version"/></not></and></condition>
		<mkdir dir="${download.dir}/metadata/frank-flow"/>
		<get src="https://nexus.frankframework.org/repository/frank-flow/org/frankframework/frank-flow/maven-metadata.xml" dest="${download.dir}/metadata/frank-flow/maven-metadata-tmp.xml" maxtime="${get.metadata.maxtime}" ignoreerrors="${get.metadata.ignoreerrors}" verbose="on" if:set="frankflow.get.metadata"/>
		<move file="${download.dir}/metadata/frank-flow/maven-metadata-tmp.xml" tofile="${download.dir}/metadata/frank-flow/maven-metadata.xml" failonerror="false" quiet="true"/>
		<xmlproperty file="${download.dir}/metadata/frank-flow/maven-metadata.xml" prefix="frankflow"/>
		<echo file="${download.dir}/metadata/frank-flow/maven-metadata-${get.metadata.tstamp}.txt" if:set="frankflow.get.metadata">metadata.versioning.release=${frankflow.metadata.versioning.release}</echo>
		<condition property="frankflow.version" value="2.27.1-20240202.120321"><matches string="${ff.version}" pattern="^([7]\.|[8]\.[01]).*$"/></condition>
		<property name="frankflow.version" value="${frankflow.metadata.versioning.release}" if:set="frankflow.metadata.versioning.release"/>
		<property name="frankflow.version" value="3.0.0-20250402.135324"/><!-- will be used when metadata xml download failed (which will not be retried for one hour) -->
		<condition property="frankflow.war" value="frank-flow-webapp-${frankflow.version}.war"><matches string="${ff.version}" pattern="^([7]\.|[8]\.[01]).*$"/></condition>
		<condition property="frankflow.url" value="https://nexus.frankframework.org/repository/public/org/ibissource/frank-flow-webapp/${frankflow.version}/${frankflow.war}"><matches string="${ff.version}" pattern="^([7]\.|[8]\.[01]).*$"/></condition>
		<property name="frankflow.war" value="frank-flow-${frankflow.version}.war"/>
		<property name="frankflow.url" value="https://nexus.frankframework.org/repository/frank-flow/org/frankframework/frank-flow/${frankflow.version}/${frankflow.war}"/>

		<available property="jdk.8.zip.available" file="${download.dir}/${jdk.8.zip}"/>
		<available property="jdk.11.zip.available" file="${download.dir}/${jdk.11.zip}"/>
		<available property="jdk.17.zip.available" file="${download.dir}/${jdk.17.zip}"/>
		<available property="jdk.21.zip.available" file="${download.dir}/${jdk.21.zip}"/>
		<available property="ant.zip.available" file="${download.dir}/${ant.zip}" if:true="${os.windows}"/>
		<available property="ant.zip.available" file="${download.dir}/${ant.gz}" unless:true="${os.windows}"/>
		<available property="ant.dir.available" file="${ant.dir}"/>
		<available property="maven.zip.available" file="${download.dir}/${maven.zip}" if:true="${os.windows}"/>
		<available property="maven.zip.available" file="${download.dir}/${maven.gz}" unless:true="${os.windows}"/>
		<available property="maven.dir.available" file="${maven.dir}"/>
		<available property="tomcat.9.zip.available" file="${download.dir}/${tomcat.9.zip}"/>
		<available property="tomcat.9.dir.available" file="${tomcat.9.dir}"/>
		<available property="tomcat.10.zip.available" file="${download.dir}/${tomcat.10.zip}"/>
		<available property="tomcat.10.dir.available" file="${tomcat.10.dir}"/>
		<available property="eclipse.zip.available" file="${download.dir}/${eclipse.zip}"/>
		<available property="eclipse.dir.available" file="${eclipse.dir}"/>
		<available property="winmerge.zip.available" file="${download.dir}/${winmerge.zip}"/>
		<available property="winmerge.dir.available" file="${winmerge.dir}"/>
		<available property="ff.war.available" file="${download.dir}/${ff.war}"/>
		<available property="frankflow.war.available" file="${download.dir}/${frankflow.war}"/>
		<available property="jta.jar.available" file="${download.dir}/${jta.jar}"/>
		<available property="activation.jar.available" file="${download.dir}/${activation.jar}"/>
		<available property="transaction.jar.available" file="${download.dir}/${transaction.jar}"/>
		<available property="jms1.jar.available" file="${download.dir}/${jms1.jar}"/>
		<available property="jms3.jar.available" file="${download.dir}/${jms3.jar}"/>
		<available property="h2v1.jar.available" file="${download.dir}/${h2v1.jar}"/>
		<available property="h2v2.jar.available" file="${download.dir}/${h2v2.jar}"/>
		<available property="h2v2java8.jar.available" file="${download.dir}/${h2v2java8.jar}"/>
		<available property="ojdbc8.jar.available" file="${download.dir}/${ojdbc8.jar}"/>
		<available property="ojdbc11.jar.available" file="${download.dir}/${ojdbc11.jar}"/>
		<available property="mssql8.jar.available" file="${download.dir}/${mssql8.jar}"/>
		<available property="mssql11.jar.available" file="${download.dir}/${mssql11.jar}"/>
		<available property="pgsql.jar.available" file="${download.dir}/${pgsql.jar}"/>
		<available property="lombok.jar.available" file="${download.dir}/${lombok.jar}"/>

		<property name="larva.windiff.command" value="${basedir}/${winmerge.dir}/WinMerge/WinMergeU.exe"/><!-- defined here and not at the beginning of this file where most properties are defined as it depends on ${winmerge.dir} -->
		<propertyset id="system.properties.set">
			<propertyref builtin="commandline"/>
			<propertyref name="dtap.stage"/>
			<propertyref name="otap.stage"/>
			<propertyref name="instance.name"/>
			<propertyref name="ibistesttool.directory"/>
			<propertyref name="larva.windiff.command"/>
			<propertyref name="frank-flow.context-path"/><!-- Frank!Flow 3.0 with F!F 8.2 doesn't need this anymore (2.27.1-20231017.123547 will be used when ff.version is 8.1 or lower) -->
			<propertyref name="application.security.http.transportGuarantee" />
			<propertyref name="application.security.console.authentication.type" />
			<propertyref name="application.security.console.authentication.username" />
			<propertyref name="application.security.console.authentication.password" />
			<propertyref name="application.security.testtool.authentication.type" />
			<propertyref name="application.security.testtool.authentication.username" />
			<propertyref name="application.security.testtool.authentication.password" />
		</propertyset>
		<property name="system.properties.comma.separated" value="${toString:system.properties.set}"/>
		<scriptdef language="javascript" name="systemproperties">
			<attribute name="name"/>
			<attribute name="commaseparated"/>
			var commaSeparated = new String(attributes.get("commaseparated")).split(', ');
			var value = '';
			for (var i = 0; i &lt; commaSeparated.length; i++) {
				if (!commaSeparated[i].startsWith('ant.')) {
					value += '\n' + new java.lang.String(commaSeparated[i]).replace("\\", "\\\\");
				}
			}
			project.setProperty(attributes.get("name"), value);
		</scriptdef>
		<systemproperties name="system.properties" commaseparated="${system.properties.comma.separated}"/>

		<property name="configurations.dirset.dir" value="${projects.dir}"/>
		<property name="configurations.dir.abs" location="${configurations.dirset.dir}/${project.dir}/${configurations.dir}"/>
		<property name="configurations.dir.rel" basedir="${configurations.dirset.dir}" value="${configurations.dir.abs}" relative="true"/><!-- the use of configurations.dir.rel makes it possible to use ../.. in configurations.dir and still have the includes work (.abs removes the ../.. and .rel will make it relative again) -->
		<property name="configurations.dirset.includes" value="${configurations.dir.rel}/*,${project.dir}_*/src/main/configuration/*,${project.dir}/configurations/*/src/main/resources/*,${project.dir}/configurations/*"/>
		<dirset id="configurations.dirs.id" dir="${configurations.dirset.dir}" includes="${configurations.dirset.includes}"/>
		<pathconvert property="configurations.dirs" refid="configurations.dirs.id" pathsep="|"/>
		<pathconvert property="configurations.dirs.flat" refid="configurations.dirs.id" pathsep="|"><flattenmapper/></pathconvert>
		<dirset id="configurations.base.path.dirs.id" dir="${projects.dir}/${project.dir}" includes="configurations/*/adapters"/>
		<pathconvert property="configurations.base.path.flat" refid="configurations.base.path.dirs.id" setonempty="false" if:set="project.dir.available"><flattenmapper/></pathconvert>
		<condition property="configurations.base.path" value="adapters"><isset property="configurations.base.path.flat"/></condition>
		<scriptdef language="javascript" name="configurationsproperties">
			<attribute name="name"/>
			<attribute name="configurationsdirabs"/>
			<attribute name="configurationnamedefault"/>
			<attribute name="configurationsnames"/>
			<attribute name="configurationsnamesds"/>
			<attribute name="configurationsdirs"/>
			<attribute name="configurationsdirsflat"/>
			<attribute name="classloadertype"/>
			<attribute name="basepath"/>
			var configurationsDirAbs = new String(attributes.get("configurationsdirabs"));
			var configurationNameDefault = new String(attributes.get("configurationnamedefault"));
			var configurationsNames = new String(attributes.get("configurationsnames"));
			var configurationsNamesDs = new String(attributes.get("configurationsnamesds"));
			var configurationsDirs = new String(attributes.get("configurationsdirs")).split('|');
			var configurationsDirsFlat = new String(attributes.get("configurationsdirsflat")).split('|');
			var classLoaderType = new String(attributes.get("classloadertype"));
			var basePath = new String(attributes.get("basepath"));
			var value = '';
			value += '\n# Set configurations.directory based on Frank!Runner properties';
			value += '\nconfigurations.directory=' + new java.lang.String(configurationsDirAbs).replace("\\", "\\\\");
			if (configurationsNames != '${configurations.names}') {
				value += '\n# Set configurations.names to Frank!Runner property with the same name';
				if (configurationNameDefault != '${configuration.name.default}') {
					value += ' (plus ' + configurationNameDefault + ' because a Configuration.xml is detected in classes.dir)';
					value += '\nconfigurations.names=' + new java.lang.String(configurationNameDefault).replace("\\", "\\\\") + ',';
				} else {
					value += '\nconfigurations.names=';
				}
				value += new java.lang.String(configurationsNames).replace("\\", "\\\\");
			} else {
				if (configurationsNamesDs == '${ds.properties.configurations.names}') {
					value += '\n# Set configurations.names to the list of folders in configurations.directory';
					if (configurationNameDefault != '${configuration.name.default}') {
						value += ' (plus ' + configurationNameDefault + ' because a Configuration.xml is detected in classes.dir)';
						value += '\nconfigurations.names=' + new java.lang.String(configurationNameDefault).replace("\\", "\\\\") + ',';
					} else {
						value += '\nconfigurations.names=';
					}
					if (configurationsDirsFlat.toString().length > 0) {
						value += new java.lang.String(configurationsDirsFlat.toString()).replace("\\", "\\\\");
					}
				} else {
					value += '\n# Don\'t set configurations.names as it is spedified in DeploymentSpecifics.properties';
				}
			}
			if (configurationsDirsFlat.toString().length > 0) {
				if (basePath == '${configurations.base.path}') basePath = '/'; // when set to empty string F!F will use default basePath (which is the configuration name)
				value += '\n# Set .classLoaderType and .directory property for every folder in configurations.directory';
				for (var i = 0; i &lt; configurationsDirs.length; i++) {
					value += '\nconfigurations.' + new java.lang.String(configurationsDirsFlat[i]).replace(" ", "\\ ") + '.classLoaderType='+ classLoaderType;
					value += '\nconfigurations.' + new java.lang.String(configurationsDirsFlat[i]).replace(" ", "\\ ") + '.directory=' + new java.lang.String(configurationsDirs[i]).replace("\\", "\\\\");
					value += '\nconfigurations.' + new java.lang.String(configurationsDirsFlat[i]).replace(" ", "\\ ") + '.basePath=' + basePath;
				}
			}
			project.setProperty(attributes.get("name"), value);
		</scriptdef>
		<configurationsproperties name="configurations.properties" configurationsdirabs="${configurations.dir.abs}" configurationnamedefault="${configuration.name.default}" configurationsnames="${configurations.names}" configurationsnamesds="${ds.properties.configurations.names}" configurationsdirs="${configurations.dirs}" configurationsdirsflat="${configurations.dirs.flat}" classloadertype="${classloader.type}" basepath="${configurations.base.path}"/>

		<property name="projects.dir.abs" location="${projects.dir}"/>
		<condition property="test.testtool.prefix" value="/" else="src/"><equals arg1="${configurations.base.path}" arg2="adapters"/></condition>
		<property name="scenariosroot.default" basedir="${projects.dir}" location="${projects.dir}/${project.dir}_${sub.project}/${tests.dir}" relative="true" if:set="sub.project"/>
		<property name="scenariosroot.default" basedir="${projects.dir}" location="${projects.dir}/${project.dir}/${modules.dir}/${module.dir}/${test.testtool.prefix}test/testtool" relative="true" if:set="module.dir"/>
		<property name="scenariosroot.default" basedir="${projects.dir}" location="${projects.dir}/${project.dir}/${tests.dir}" relative="true"/>
		<property name="tests.dirset.dir" value="${projects.dir}"/>
		<property name="tests.dir.abs" location="${tests.dirset.dir}/${project.dir}/${tests.dir}"/>
		<property name="tests.dir.rel" basedir="${tests.dirset.dir}" value="${tests.dir.abs}" relative="true"/><!-- the use of tests.dir.rel makes it possible to use ../.. in tests.dir and still have the includes work (.abs removes the ../.. and .rel will make it relative again) -->
		<property name="tests.dirset.includes" value="${tests.dir.rel},${project.dir}_*/src/test/testtool,${project.dir}/configurations/*/src/test/testtool,${project.dir}/configurations/*/test/testtool"/>
		<dirset id="tests.dirs.id" dir="${tests.dirset.dir}" includes="${tests.dirset.includes}"/>
		<pathconvert property="tests.dirs" refid="tests.dirs.id" pathsep="|"/>
		<scriptdef language="javascript" name="testsproperties">
			<attribute name="name"/>
			<attribute name="projectsdirabs"/>
			<attribute name="scenariosrootdefault"/>
			<attribute name="testsdirs"/>
			var projectsDirAbs = new String(attributes.get("projectsdirabs"));
			var scenariosrootDefault = new String(attributes.get("scenariosrootdefault"));
			var testsDirs = new String(attributes.get("testsdirs")).split('|');
			var value = '';
			if (scenariosrootDefault != '${scenariosroot.default}') {
				value += '\nscenariosroot.default=' + new java.lang.String(scenariosrootDefault).replace("\\", "\\\\");
			}
			for (var i = 0; i &lt; testsDirs.length; i++) {
				value += '\nscenariosroot' + (i + 1) + '.description='+ new java.lang.String(testsDirs[i].substring(projectsDirAbs.length + 1)).replace("\\", "\\\\");
				value += '\nscenariosroot' + (i + 1) + '.directory=' + new java.lang.String(testsDirs[i]).replace("\\", "\\\\");
			}
			project.setProperty(attributes.get("name"), value);
		</scriptdef>
		<testsproperties name="tests.properties" projectsdirabs="${projects.dir.abs}" scenariosrootdefault="${scenariosroot.default}" testsdirs="${tests.dirs}"/>

		<loadresource property="jdk.8.dir.windows"><propertyresource name="jdk.8.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="jdk.11.dir.windows"><propertyresource name="jdk.11.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="jdk.17.dir.windows"><propertyresource name="jdk.17.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="jdk.21.dir.windows"><propertyresource name="jdk.21.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="fr.jdk.dir.windows"><propertyresource name="fr.jdk.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="ant.dir.windows"><propertyresource name="ant.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="rhino.dir.windows"><propertyresource name="rhino.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="maven.dir.windows"><propertyresource name="maven.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="tomcat.9.dir.windows"><propertyresource name="tomcat.9.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="tomcat.10.dir.windows"><propertyresource name="tomcat.10.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>
		<loadresource property="tomcat.jdk.default.dir.windows"><propertyresource name="tomcat.jdk.default.dir"/><filterchain><tokenfilter><filetokenizer/><replacestring from="/" to="\"/></tokenfilter></filterchain></loadresource>

		<tstamp><format property="get.build.tstamp" pattern="yyyyMMdd"/></tstamp>
		<condition property="get.build"><not><resourceexists><file file="${download.dir}/frank-runner/build-${get.build.tstamp}.txt"/></resourceexists></not></condition>
		<property name="get.build.maxtime" value="10"/>
		<property name="get.build.ignoreerrors" value="true"/>
		<mkdir dir="${download.dir}/frank-runner"/>
		<get src="https://raw.githubusercontent.com/ibissource/frank-runner/master/build.xml" dest="${download.dir}/frank-runner/build.xml" maxtime="${get.build.maxtime}" ignoreerrors="${get.build.ignoreerrors}" verbose="on" if:set="get.build"/>
		<echo file="${download.dir}/frank-runner/build-${get.build.tstamp}.txt" if:set="get.build"/>
		<copy file="build.xml" tofile="${download.dir}/frank-runner/build.xml"/><!-- overwrite when newer, e.g. when git pull is done when build.xml is already downloaded that day -->
		<condition property="frank.runner.up.to.date"><or><filesmatch file1="build.xml" file2="${download.dir}/frank-runner/build.xml" textfile="true"/><not><resourceexists><file file="${download.dir}/frank-runner/build.xml"/></resourceexists></not></or></condition>
	</target>

	<target name="install" depends="init,get.java,get.ant,get.maven,get.tomcat,get.eclipse,get.lombok,get.winmerge,get.ff,get.frankflow,get.jta,get.activation,get.transaction,get.jms,get.h2v1,get.h2v2,get.h2v2java8,get.ojdbc,get.mssql,get.pgsql">
		<!-- jdk -->
		<antcall target="install.jdk"><param name="jdk.dir" value="${jdk.8.dir}"/><param name="jdk.zip" value="${jdk.8.zip}"/><param name="jdk.tar" value="${jdk.8.tar}"/><param name="cacerts.dir" value="jre/lib/security"/></antcall><!-- default cacerts.dir for cacerts task is lib/security -->
		<antcall target="install.jdk"><param name="jdk.dir" value="${jdk.11.dir}"/><param name="jdk.zip" value="${jdk.11.zip}"/><param name="jdk.tar" value="${jdk.11.tar}"/></antcall>
		<antcall target="install.jdk"><param name="jdk.dir" value="${jdk.17.dir}"/><param name="jdk.zip" value="${jdk.17.zip}"/><param name="jdk.tar" value="${jdk.17.tar}"/></antcall>
		<antcall target="install.jdk"><param name="jdk.dir" value="${jdk.21.dir}"/><param name="jdk.zip" value="${jdk.21.zip}"/><param name="jdk.tar" value="${jdk.21.tar}"/></antcall>
		<!-- ant -->
		<unzip src="${download.dir}/${ant.zip}" dest="build" unless:set="ant.dir.available" if:true="${os.windows}">
			<patternset>
				<exclude name="**/manual"/>
			</patternset>
		</unzip>
		<gunzip src="${download.dir}/${ant.gz}" dest="build" unless:set="ant.dir.available" unless:true="${os.windows}"/>
		<untar src="build/${ant.tar}" dest="build" unless:set="ant.dir.available" unless:true="${os.windows}">
			<patternset>
				<exclude name="**/manual"/>
			</patternset>
		</untar>
		<delete file="build/${ant.tar}" unless:set="ant.dir.available" unless:true="${os.windows}"/>
		<chmod file="${ant.dir}/bin/ant" perm="+x" unless:set="ant.dir.available" unless:true="${os.windows}"/>
		<chmod file="${ant.dir}/bin/antRun" perm="+x" unless:set="ant.dir.available" unless:true="${os.windows}"/>
		<!-- maven -->
		<unzip src="${download.dir}/${maven.zip}" dest="build" unless:set="maven.dir.available" if:true="${os.windows}"/>
		<gunzip src="${download.dir}/${maven.gz}" dest="build" unless:set="maven.dir.available" unless:true="${os.windows}"/>
		<untar src="build/${maven.tar}" dest="build" unless:set="maven.dir.available" unless:true="${os.windows}"/>
		<chmod file="${maven.dir}/bin/mvn" perm="+x" unless:set="maven.dir.available" unless:true="${os.windows}"/>
		<delete file="build/${maven.tar}" unless:set="maven.dir.available" unless:true="${os.windows}"/>
		<mkdir dir="build/webapps"/>
		<property name="webapp.dir" value="build/webapps/${context.path}" unless:true="${maven}"/>
		<property name="webapp.dir" value="${projects.dir}/${project.dir}/${war.dir}/src/main/webapp" if:set="war.pom.xml.available" if:true="${maven}"/>
		<property name="webapp.dir" value="${projects.dir}/${project.dir}/src/main/webapp" if:set="pom.xml.available" if:true="${maven}"/>
		<property name="webapp.gitignore" value="/iaf/&#10;/images/&#10;/js/&#10;/jsp/&#10;/larva/&#10;/META-INF/maven/&#10;/META-INF/jboss-all.xml&#10;/META-INF/MANIFEST.MF&#10;/testtool/&#10;/WEB-INF/&#10;/body.css&#10;/favicon.ico&#10;/ie4.css&#10;/ie55.css" if:true="${maven}"/>
		<property name="webapp.clean" value="     iaf/**    images/**    js/**    jsp/**    larva/**    META-INF/maven/**    META-INF/jboss-all.xml      META-INF/MANIFEST.MF      testtool/**    WEB-INF/**    body.css      favicon.ico      ie4.css      ie55.css" unless:true="${maven.skip.clean}"/>
		<condition property="webapp.gitignore.add" unless:true="${webapp.gitignore.skip}" if:true="${maven}"><not><resourcecontains resource="${webapp.dir}/.gitignore" substring="${webapp.gitignore}"/></not></condition>
		<condition property="webapp.gitignore.add.newline" if:true="${webapp.gitignore.add}"><length file="${webapp.dir}/.gitignore" when="greater" length="0"/></condition>
		<echo file="${webapp.dir}/.gitignore" message="&#10;" append="true" if:true="${webapp.gitignore.add.newline}"/>
		<echo file="${webapp.dir}/.gitignore" message="${webapp.gitignore}" append="true" if:true="${webapp.gitignore.add}"/>
		<property name="project.gitignore" value="/target/" if:true="${maven}"/>
		<condition property="project.gitignore.add" unless:true="${project.gitignore.skip}" if:true="${maven}"><not><resourcecontains resource="${maven.exec.dir}/.gitignore" substring="${project.gitignore}"/></not></condition>
		<condition property="project.gitignore.add.newline" if:true="${project.gitignore.add}"><length file="${maven.exec.dir}/.gitignore" when="greater" length="0"/></condition>
		<echo file="${maven.exec.dir}/.gitignore" message="&#10;" append="true" if:true="${project.gitignore.add.newline}"/>
		<echo file="${maven.exec.dir}/.gitignore" message="${project.gitignore}" append="true" if:true="${project.gitignore.add}"/>
		<delete includeEmptyDirs="true" verbose="${maven.verbose}" unless:true="${webapp.clean.skip}" if:true="${maven}"><fileset dir="${webapp.dir}" includes="${webapp.clean}" defaultexcludes="false"/></delete><!-- maven clean war:inplace doesn't clean the webapp (see also: https://stackoverflow.com/questions/12497081/maven-war-inplace-clean-classes-and-lib-folder) -->
		<condition property="mvn.exe" value="${basedir}\mvn.bat" else="/bin/bash"><os family="windows"/></condition>
		<condition property="mvn.arg" value="${basedir}/mvn.sh" else=""><os family="unix"/></condition>
		<exec executable="${mvn.exe}" dir="${maven.exec.dir}" vmlauncher="false" failonerror="true" if:true="${maven}">
			<arg value="${mvn.arg}" unless:blank="${mvn.arg}"/>
			<arg value="--settings" if:set="maven.settings.xml"/>
			<arg value="${maven.settings.xml}" if:set="maven.settings.xml"/>
			<arg value="${maven.args}" if:set="maven.args"/>
			<arg value="clean" unless:true="${maven.skip.clean}"/>
			<arg value="${maven.phase}"/>
			<arg value="war:inplace"/>
			<arg value="--update-snapshots"/>
			<arg value="--debug" if:true="${maven.verbose}"/>
			<arg value="-DskipTests" if:true="${maven.skip.tests}"/>
			<arg value="-Dmaven.javadoc.skip=true" if:true="${maven.skip.javadoc}"/>
		</exec>
		<!-- tomcat -->
		<antcall target="install.tomcat.9"></antcall>
		<antcall target="install.tomcat.10"></antcall>
		<!-- eclipse -->
		<condition property="eclipse.and.os.windows"><and><istrue value="${eclipse}"/><istrue value="${os.windows}"/></and></condition>
		<unzip src="${download.dir}/${eclipse.zip}" dest="${eclipse.dir}" unless:set="eclipse.dir.available" if:true="${eclipse.and.os.windows}"><cutdirsmapper dirs="1"/></unzip>
		<gunzip src="${download.dir}/${eclipse.zip}" dest="build" unless:set="eclipse.dir.available" if:true="${eclipse}" unless:true="${os.windows}"/>
		<untar src="build/${eclipse.tar}" dest="${eclipse.dir}" unless:set="eclipse.dir.available" if:true="${eclipse}" unless:true="${os.windows}"><cutdirsmapper dirs="1"/></untar>
		<delete file="build/${eclipse.tar}" unless:set="eclipse.dir.available" if:true="${eclipse}" unless:true="${os.windows}"/>
		<chmod file="${eclipse.dir}/eclipse" perm="+x" unless:set="eclipse.dir.available" if:true="${eclipse}" unless:true="${os.windows}"/>
		<chmod dir="${eclipse.dir}/plugins/" includes="**/jre/bin/*" perm="+x" unless:set="eclipse.dir.available" if:true="${eclipse}" unless:true="${os.windows}"/>
		<copy todir="${eclipse.dir}" file="${download.dir}/${lombok.jar}" unless:set="eclipse.dir.available" if:true="${eclipse}"/>
		<concat destfile="${eclipse.dir}/eclipse.ini" append="true" unless:set="eclipse.dir.available" if:true="${eclipse}">-javaagent:${lombok.jar}&#13;&#10;</concat>
		<antcall target="install.cacerts" if:true="${eclipse}"><param name="jdk.dir" value="${eclipse.dir}/${eclipse.jre.dir}"/><param name="cacerts.dir" value="lib/security"/></antcall>
		<!-- winmerge -->
		<unzip src="${download.dir}/${winmerge.zip}" dest="${winmerge.dir}" unless:set="winmerge.dir.available"/>
		<!-- webapp -->
		<property file="${webapp.dir}/META-INF/maven/org.frankframework/frankframework-webapp/pom.properties" prefix="ff.pom.properties.old."/>
		<property file="${webapp.dir}/META-INF/maven/org.ibissource/ibis-adapterframework-webapp/pom.properties" prefix="ff.pom.properties.old."/>
		<property name="frankflow.dir" value="build/webapps/frank-flow"/>
		<property file="${frankflow.dir}/META-INF/maven/org.ibissource/frank-flow-webapp/pom.properties" prefix="frankflow.pom.properties.old."/>
		<property file="${frankflow.dir}/META-INF/maven/org.frankframework/frank-flow/pom.properties" prefix="frankflow.pom.properties.old."/>
		<pathconvert property="contexts.dirs" dirsep="," pathsep=","><dirset dir="build/webapps" includes="*" excludes="frank-flow"/><flattenmapper/></pathconvert>
		<condition property="maven.or.ff.version.changed.or.context.path.changed"><or><istrue value="${maven}"/><not><equals arg1="${ff.version}" arg2="${ff.pom.properties.old.version}"/></not><not><equals arg1="${contexts.dirs}" arg2="${context.path}"/></not></or></condition>
		<condition property="frankflow.version.changed"><not><equals arg1="${frankflow.version}" arg2="${frankflow.pom.properties.old.version}"/></not></condition>
		<delete includeemptydirs="true" if:set="maven.or.ff.version.changed.or.context.path.changed"><fileset dir="build/webapps" includes="**/*" excludes="frank-flow/**/*"/></delete>
		<delete includeemptydirs="true" if:set="frankflow.version.changed"><fileset dir="build/webapps" includes="frank-flow/**/*"/></delete>
		<unzip src="${download.dir}/${ff.war}" dest="${webapp.dir}" if:set="maven.or.ff.version.changed.or.context.path.changed" unless:true="${maven}"/>
		<unzip src="${download.dir}/${frankflow.war}" dest="${frankflow.dir}" if:set="frankflow.version.changed"/>
 		<delete><fileset dir="${webapp.dir}/WEB-INF/lib" includes="**-CUSTOM.jar"/></delete>
		<available property="lib.webapp.dir.available" file="${projects.dir}/${project.dir}/${lib.webapp.dir}"/>
		<copy todir="${webapp.dir}/WEB-INF/lib" if:set="lib.webapp.dir.available"><fileset dir="${projects.dir}/${project.dir}/${lib.webapp.dir}"/><globmapper from="*.jar" to="*-CUSTOM.jar"/></copy>
		<pathconvert property="webapp.lib.jars" pathsep="|"><fileset dir="${webapp.dir}/WEB-INF/lib" includes="*.jar"/><flattenmapper/></pathconvert>
		<doublejars jars="${webapp.lib.jars}"/>
		<!-- ff version dependent properties -->
		<property file="${webapp.dir}/META-INF/maven/org.frankframework/frankframework-webapp/pom.properties" prefix="ff.pom.properties."/>
		<property file="${webapp.dir}/META-INF/maven/org.ibissource/ibis-adapterframework-webapp/pom.properties" prefix="ff.pom.properties."/>
		<condition property="tomcat.dir" value="${tomcat.9.dir}"><matches string="${ff.pom.properties.version}" pattern="^([567]\.|[8]\.[01]).*$"/></condition><!-- 8.1 is the last version running on Tomcat 9 -->
		<condition property="tomcat.dir.windows" value="${tomcat.9.dir.windows}"><matches string="${ff.pom.properties.version}" pattern="^([567]\.|[8]\.[01]).*$"/></condition>
		<property name="tomcat.dir" value="${tomcat.10.dir}"/>
		<property name="tomcat.dir.windows" value="${tomcat.10.dir.windows}"/>
		<fileset id="jdk8.fallback.fileset" dir="${webapp.dir}/WEB-INF/lib" includes="ibis-adapterframework-core-*.jar"><!-- check jar files as maven doesn't use ff.version (now ff.pom.properties.version can probably be used) -->
			<filename regex="core-7\."/>
		</fileset>
		<pathconvert property="jdk8.fallback" refid="jdk8.fallback.fileset" />
		<property name="tomcat.jdk.dir" value="${jdk.8.dir}" unless:blank="${jdk8.fallback}"/>
		<property name="tomcat.jdk.dir.windows" value="${jdk.8.dir.windows}" unless:blank="${jdk8.fallback}"/>
		<fileset id="jdk11.fallback.fileset" dir="${webapp.dir}/WEB-INF/lib" includes="frankframework-core-*.jar">
			<filename regex="core-8\.0"/>
		</fileset>
		<pathconvert property="jdk11.fallback" refid="jdk11.fallback.fileset" />
		<property name="tomcat.jdk.dir" value="${jdk.11.dir}" unless:blank="${jdk11.fallback}"/>
		<property name="tomcat.jdk.dir.windows" value="${jdk.11.dir.windows}" unless:blank="${jdk11.fallback}"/>
		<property name="tomcat.jdk.dir" value="${tomcat.jdk.default.dir}"/>
		<property name="tomcat.jdk.dir.windows" value="${tomcat.jdk.default.dir.windows}"/>
		<fileset id="h2.fallback.fileset" dir="${webapp.dir}/WEB-INF/lib" includes="ibis-adapterframework-core-*.jar">
			<or><filename regex="core-7\.[0-6]"/><filename regex="core-7\.7-2021"/><filename regex="core-7\.7-2022010"/><filename regex="core-7\.7-2022011[0-7]"/></or><!-- <= 7.7-20220117.131048: h2 + liquibase requires h2 version 1, >= 7.7-20220119.104942: h2 + liquibase requires h2 version 2 -->
		</fileset>
		<pathconvert property="h2.fallback" refid="h2.fallback.fileset" />
		<fileset id="h2v2.fallback.fileset" dir="${webapp.dir}/WEB-INF/lib" includes="ibis-adapterframework-core-*.jar">
			<or><filename regex="core-7\.7-2022011[8-9]"/><filename regex="core-7\.7-202201[2-9]"/><filename regex="core-7\.7-20220[2-9]"/><filename regex="core-7\.[8-9]"/></or> <!-- > 7.7.20220117, 7.8 and 7.9 require an older version of h2 version 2 that supports Java 8. Only 8.x or later supports the latest h2 version 2 driver, which requires Java 11 or later -->
		</fileset>
		<pathconvert property="h2v2.fallback" refid="h2v2.fallback.fileset" />
		<property name="h2.jar" value="${h2v1.jar}" unless:blank="${h2.fallback}"/>
		<property name="h2.jar" value="${h2v2java8.jar}" unless:blank="${h2v2.fallback}"/>
		<property name="h2.jar" value="${h2v2.jar}"/>
		<property name="h2.dir" value="${h2v1.dir}" unless:blank="${h2.fallback}"/>
		<property name="h2.dir" value="${h2v2java8.dir}" unless:blank="${h2v2.fallback}"/>
		<property name="h2.dir" value="${h2v2.dir}"/>
		<!-- h2 -->
		<delete><fileset dir="${tomcat.dir}/lib" includes="h2-*.jar" excludes="${h2.jar}"/></delete>
		<copy file="${download.dir}/${h2.jar}" todir="${tomcat.dir}/lib"/>
		<!-- context.xml -->
		<property name="context.xml.target" value="${tomcat.dir}/conf/Catalina/localhost/${context.path}.xml"/>
		<delete dir="${tomcat.dir}/conf/Catalina/localhost"/><!-- xml file could have a different name in previous run or in previous run maven could be true and in current run false -->
		<available property="resources.yml.available" file="${projects.dir}/${project.dir}/${classes.dir}/resources.yml"/>
		<available property="context.xml.source" value="${projects.dir}/${project.dir}/${context.xml}" file="${projects.dir}/${project.dir}/${context.xml}"/>
		<property name="context.xml.source" value="database/${database.type}/context.xml"/>
		<copy file="${context.xml.source}" tofile="${context.xml.target}" unless:set="resources.yml.available" verbose="${debug.true}"/>
		<replace file="${context.xml.target}" token="@instance.name.lc@" value="${instance.name.lc}" unless:set="resources.yml.available" summary="${debug.true}"/>
		<replace file="${context.xml.target}" token="@h2.dir@" value="${h2.dir}" unless:set="resources.yml.available" summary="${debug.true}"/>
		<echo message="&lt;Context&gt;&lt;/Context&gt;" file="${context.xml.target}" if:set="resources.yml.available"/>
		<property name="webapp.dir.abs" location="${webapp.dir}"/>
		<replace file="${context.xml.target}" token="&lt;Context>" value="&lt;Context docBase=&quot;${webapp.dir.abs}&quot;>" summary="${debug.true}"/>
		<property name="frankflow.dir.abs" location="${frankflow.dir}"/>
		<echo file="${tomcat.dir}/conf/Catalina/localhost/frank-flow.xml" message="&lt;Context docBase=&quot;${frankflow.dir.abs}&quot;/>"/>
		<property name="frankflow.active" value="true"/>
		<delete file="${tomcat.dir}/conf/Catalina/localhost/frank-flow.xml" unless:true="${frankflow.active}"/>
		<!-- classes -->
		<delete dir="${webapp.dir}/WEB-INF/classes" unless:true="${maven}"/>
		<mkdir dir="${webapp.dir}/WEB-INF/classes" unless:true="${maven}"/>
		<available property="java.dir.available" file="${projects.dir}/${project.dir}/${java.dir}"/>
		<property name="javac.release" value="8" unless:blank="${jdk8.fallback}"/>
		<property name="javac.release" value="11"/>
		<javac srcdir="${projects.dir}/${project.dir}/${java.dir}" destdir="${webapp.dir}/WEB-INF/classes" release="${javac.release}" includeantruntime="false" if:set="java.dir.available" unless:true="${maven}">
			<classpath>
				<fileset dir="${download.dir}"><include name="${lombok.jar}"/></fileset>
				<fileset dir="${webapp.dir}/WEB-INF/lib"><include name="*.jar"/></fileset>
				<fileset dir="${tomcat.dir}/lib"><include name="*.jar"/></fileset>
			</classpath>
			<compilerarg line="-processor lombok.launch.AnnotationProcessorHider$AnnotationProcessor"/><!-- prevent warning in java 21: ... future release of javac may disable annotation processing ... -->
		</javac>
		<available property="classes.dir.available" file="${projects.dir}/${project.dir}/${classes.dir}"/>
		<copy todir="${webapp.dir}/WEB-INF/classes" if:set="classes.dir.available" unless:true="${maven}">
			<fileset dir="${projects.dir}/${project.dir}/${classes.dir}"/>
		</copy>
		<!-- frank config xsd -->
		<condition property="update.config.xsd">
			<or>
				<istrue value="${maven}"/><!-- f!f version could be changed -->
				<not><equals arg1="${ff.version}" arg2="${ff.pom.properties.old.version}"/></not><!-- f!f version changed -->
				<not><resourceexists><file file="${configurations.dir}/FrankConfig.xsd"/></resourceexists></not><!-- maybe a new project and f!f version not changed -->
			</or>
		</condition>
		<delete file="build/frankdoc/FrankConfig.xsd" if:true="${update.config.xsd}"/><!-- prevent available task after unjar to detect xsd from previous ff version when current ff version doesn't have one -->
		<delete file="build/frankdoc/FrankConfig-strict.xsd" if:true="${update.config.xsd}" />
		<unjar dest="build/frankdoc" if:true="${update.config.xsd}">
			<fileset dir="${webapp.dir}/WEB-INF/lib" includes="frankframework-core-*.jar,ibis-adapterframework-core-*.jar"></fileset>
			<patternset>
				<include name="xml/xsd/FrankConfig-strict.xsd"/>
				<include name="xml/xsd/FrankConfig.xsd"/>
			</patternset>
			<flattenmapper/>
		</unjar>
		<condition property="update.config.xsd.and.available">
			<and>
				<istrue value="${update.config.xsd}"/>
				<or>
				    <available file="build/frankdoc/FrankConfig.xsd"/>
				    <available file="build/frankdoc/FrankConfig-strict.xsd"/>
				</or>
			</and>
		</condition>
		<condition property="move.config.strict.xsd"><!-- somewhere in 2022 FrankConfig.xsd was added (before that we needed to use FrankConfig-strict.xsd) -->
			<and>
				<istrue value="${update.config.xsd.and.available}"/>
				<not><available file="build/frankdoc/FrankConfig.xsd"/></not>
			</and>
		</condition>
		<move file="build/frankdoc/FrankConfig-strict.xsd" tofile="build/frankdoc/FrankConfig.xsd" if:true="${move.config.strict.xsd}"/>
		<scriptdef language="javascript" name="multicopyconfigxsd"><!-- configs can be divided over serveral modules/projects, hence a copy to configurations.dir only is not enough) -->
			<attribute name="configurationsdirs"/>
			<attribute name="basepath"/>
			var configurationsDirs = new String(attributes.get("configurationsdirs")).split('|'); // paths that include a specific config name at the end
			var configurationsDir = "/.."; // go one up to reach the configurations.dir holding one or more specific configs
			if (attributes.get("basepath") == 'adapters') configurationsDir = '/'; // keep reference to xsd in config xml working with ../FrankConfig.xsd like with other setups and rutime deployments (otherwise with the extra adapters ../../FrankConfig.xsd would be needed to reach the configurations.dir) 
			for (var i = 0; i &lt; configurationsDirs.length; i++) {
				if (configurationsDirs[i].length > 0) {
					var task = project.createTask("antcall");
					task.setTarget("copy.config.xsd");
					var param = task.createParam();
					param.setName("dir");
					param.setValue(configurationsDirs[i] + configurationsDir);
					task.perform();
				}
			}
		</scriptdef>
		<multicopyconfigxsd configurationsdirs="${configurations.dirs}" basepath="${configurations.base.path}" if:true="${update.config.xsd}"/>
		<antcall target="copy.config.xsd" if:true="${update.config.xsd}"><param name="dir" value="${projects.dir}/${project.dir}/${classes.dir}/.."/><param name="dir2check" value="${projects.dir}/${project.dir}/${classes.dir}"/></antcall>
		<dirset id="project.dirs.id" dir="${configurations.dirset.dir}" includes="${project.dir},${project.dir}_*" if:true="${update.config.xsd.and.available}"/>
		<pathconvert property="project.dirs" refid="project.dirs.id" pathsep="|" if:true="${update.config.xsd.and.available}"/>
		<scriptdef language="javascript" name="multiaddgitignore"><!-- configs can be divided over serveral projects, hence a copy to project.dir only is not enough) -->
			<attribute name="dirs"/>
			var dirs = new String(attributes.get("dirs")).split('|');
			for (var i = 0; i &lt; dirs.length; i++) {
				if (dirs[i].length > 0) {
					var task = project.createTask("antcall");
					task.setTarget("add.gitignore");
					var param1 = task.createParam();
					param1.setName("dir");
					param1.setValue(dirs[i]);
					var param2 = task.createParam();
					param2.setName("ignore");
					param2.setValue("FrankConfig.xsd");
					task.perform();
				}
			}
		</scriptdef>
		<multiaddgitignore dirs="${project.dirs}" if:true="${update.config.xsd.and.available}"/>
		<!-- scripts -->
		<antcall target="generate.bat"><param name="filename" value="ant"/></antcall>
		<antcall target="generate.bat"><param name="filename" value="mvn"/></antcall>
		<antcall target="generate.bat"><param name="filename" value="env"/></antcall>
		<antcall target="generate.bat"><param name="filename" value="cmd"/></antcall>
		<antcall target="generate.bat"><param name="filename" value="start"/></antcall>
		<antcall target="generate.bat"><param name="filename" value="stop"/></antcall>
		<antcall target="generate.bat"><param name="filename" value="run"/></antcall>
		<antcall target="generate.bat"><param name="filename" value="restart"/></antcall>
		<antcall target="generate.bat"><param name="filename" value="rerun"/></antcall>
		<antcall target="generate.sh"><param name="filename" value="ant"/></antcall>
		<antcall target="generate.sh"><param name="filename" value="mvn"/></antcall>
		<antcall target="generate.sh"><param name="filename" value="env"/></antcall>
		<antcall target="generate.sh"><param name="filename" value="start"/></antcall>
		<antcall target="generate.sh"><param name="filename" value="stop"/></antcall>
		<antcall target="generate.sh"><param name="filename" value="run"/></antcall>
		<antcall target="generate.sh"><param name="filename" value="restart"/></antcall>
		<antcall target="generate.sh"><param name="filename" value="rerun"/></antcall>
	</target>

	<target name="tomcat">
		<condition property="catalina.exe" value="${tomcat.dir.windows}\bin\catalina.bat" else="${tomcat.dir}/bin/catalina.sh"><os family="windows"/></condition>
		<property name="catalina.out" value="${tomcat.dir}/logs/tomcat-${action}.txt"/>
		<property name="redirect.out" value="true"/>
		<exec executable="${catalina.exe}" vmlauncher="false" failonerror="true" if:true="${use.exec}">
			<arg value="${action}"/>
			<env key="JAVA_HOME" value="${tomcat.jdk.dir}" unless:true="${os.windows}"/>
			<env key="JAVA_HOME" value="${tomcat.jdk.dir.windows}" if:true="${os.windows}"/>
			<env key="CATALINA_HOME" value="${tomcat.dir}" unless:true="${os.windows}"/>
			<env key="CATALINA_HOME" value="${tomcat.dir.windows}" if:true="${os.windows}"/>
			<env key="JAVA_OPTS" value="-Xmx${maxmemory}"/>
			<redirector output="${catalina.out}" if:true="${redirect.out}"/>
		</exec>
		<property name="tomcat.java.jvm" value="${basedir}/${tomcat.jdk.dir}/bin/java" unless:true="${os.windows}"/>
		<property name="tomcat.java.jvm" value="${basedir}\${tomcat.jdk.dir.windows}\bin\java.exe" if:true="${os.windows}"/>
		<property name="spawn" value="true"/>
		<java jvm="${tomcat.java.jvm}" classname="org.apache.catalina.startup.Bootstrap" fork="true" failonerror="true" spawn="${spawn}" maxmemory="${maxmemory}" if:true="${use.java}">
			<jvmarg value="-Dcatalina.home=${tomcat.dir}"/>
			<jvmarg value="--add-opens=java.base/java.lang=ALL-UNNAMED" if:blank="${jdk8.fallback}"/><!-- Fixes classloading issue, see https://github.com/wearefrank/frank-runner/pull/86 (this option is not available on JDK 8) -->
			<arg value="${action}"/>
			<classpath>
				<fileset dir="${tomcat.dir}/bin"><include name="*.jar"/></fileset>
				<fileset dir="${tomcat.dir}/lib"><include name="*.jar"/></fileset>
			</classpath>
		</java>
	</target>

	<target name="start" depends="install">
		<!-- with exec in windows a new window will be opened -->
		<condition property="use.exec"><not><equals arg1="${use}" arg2="java"/></not></condition>
		<!-- with java in windows no new window will be opened -->
		<condition property="use.java"><equals arg1="${use}" arg2="java"/></condition>
		<antcall target="tomcat"><param name="action" value="start"/></antcall>
		<antcall target="splash"/>
	</target>

	<target name="run" depends="install">
		<antcall target="splash"/>
		<echo message=" "/><!-- space instead of empty for eclipse -->
		<echo message=" "/>
		<!-- use java by default as with exec in windows a ctrl-c will not kill tomcat -->
		<condition property="use.exec" else="false"><equals arg1="${use}" arg2="exec"/></condition>
		<condition property="use.java" else="false"><not><equals arg1="${use}" arg2="exec"/></not></condition>
		<property name="spawn" value="false"/>
		<property name="redirect.out" value="false"/>
		<!-- with exec in windows a ctrl-c will not kill tomcat -->
		<antcall target="tomcat" if:true="${use.exec}"><param name="action" value="run"/></antcall>
		<!-- with java in windows a ctrl-c will kill tomcat -->
		<antcall target="tomcat" if:true="${use.java}"><param name="action" value="start"/></antcall>
	</target>

	<!-- don't add depends="install" because when tomcat is running resources may be locked which will result in "Unable to delete file" build failures -->
	<target name="stop" depends="init">
		<condition property="catalina.bat.present"><resourceexists><file file="${tomcat.10.dir}/bin/catalina.bat"/></resourceexists></condition><!-- not present when build.xml is running for the first time or tomcat.version has changed. see comment behind tomcat.dir below about using version 10 -->
		<antcall target="install" unless:set="catalina.bat.present"/>
		<condition property="tomcat.running"><or><socket server="localhost" port="${tomcat.port}"/><socket server="localhost" port="${tomcat.server.port}"/></or></condition>
		<condition property="use.exec" if:set="tomcat.running"><not><equals arg1="${use}" arg2="java"/></not></condition>
		<condition property="use.java" if:set="tomcat.running"><equals arg1="${use}" arg2="java"/></condition>
		<antcall target="tomcat">
			<param name="action" value="stop"/>
			<param name="tomcat.dir" value="${tomcat.10.dir}"/><!-- version 10 can also be used to stop version 9. target stop doesn't depend on install which would set tomcat.dir (based on ff version), hence pass tomcat.dir as a param -->
			<param name="tomcat.dir.windows" value="${tomcat.10.dir.windows}"/>
			<param name="tomcat.jdk.dir" value="${jdk.21.dir}"/><!-- any version supported by tomcat will be fine. target stop doesn't depend on install which would set tomcat.jdk.dir (based on ff version), hence pass tomcat.jdk.dir as a param -->
			<param name="tomcat.jdk.dir.windows" value="${jdk.21.dir.windows}"/>
		</antcall>
		<tstamp><format property="stop.begin" pattern="HH:mm:ss"/></tstamp>
		<property name="stop.maxwait" value="300"/>
		<property name="stop.maxwaitunit" value="second"/>
		<echo message="${stop.begin} Wait max ${stop.maxwait} ${stop.maxwaitunit}s for Tomcat to stop" if:set="tomcat.running" unless:true="${tomcat.skip.waitfor}"/>
		<waitfor maxwait="${stop.maxwait}" maxwaitunit="${stop.maxwaitunit}" timeoutproperty="stop.failed" if:set="tomcat.running" unless:true="${tomcat.skip.waitfor}">
			<not><or><socket server="localhost" port="${tomcat.port}"/><socket server="localhost" port="${tomcat.server.port}"/></or></not>
		</waitfor>
		<fail message="Tomcat (or another process) is still running on port ${tomcat.port} and/or ${tomcat.server.port}. Please stop Tomcat manually or try again" if:set="stop.failed"/>
		<tstamp><format property="stop.end" pattern="HH:mm:ss"/></tstamp>
		<echo message="${stop.end} Done" if:set="tomcat.running" unless:true="${tomcat.skip.waitfor}"/>
	</target>

	<target name="restart" depends="init">
		<antcall target="stop"/>
		<property name="restart.start" value="run" unless:true="${os.windows}"/><!-- show startup output and make it work when executed by vscode task explorer (which seems to kill the tomcat start command when the script calling it is ready) -->
		<property name="restart.start" value="start" if:true="${os.windows}"/><!-- on windows tomcat will open a new window which will show startup output and will not be killed by vscode task explorer when the script starting it is ready-->
		<antcall target="${restart.start}"/>
	</target>

	<target name="rerun">
		<antcall target="stop"/>
		<antcall target="run"/>
	</target>

	<target name="get.java">
		<get src="${jdk.8.url.win}" dest="${download.dir}/${jdk.8.zip}" verbose="on" if:true="${os.windows}" unless:true="${jdk.8.zip.available}"/>
		<get src="${jdk.8.url.lin}" dest="${download.dir}/${jdk.8.zip}" verbose="on" if:true="${os.linux}" unless:true="${jdk.8.zip.available}"/>
		<get src="${jdk.8.url.mac}" dest="${download.dir}/${jdk.8.zip}" verbose="on" if:true="${os.mac}" unless:true="${jdk.8.zip.available}"/>
		<get src="${jdk.11.url.win}" dest="${download.dir}/${jdk.11.zip}" verbose="on" if:true="${os.windows}" unless:true="${jdk.11.zip.available}"/>
		<get src="${jdk.11.url.lin}" dest="${download.dir}/${jdk.11.zip}" verbose="on" if:true="${os.linux}" unless:true="${jdk.11.zip.available}"/>
		<get src="${jdk.11.url.mac}" dest="${download.dir}/${jdk.11.zip}" verbose="on" if:true="${os.mac}" unless:true="${jdk.11.zip.available}"/>
		<get src="${jdk.17.url.win}" dest="${download.dir}/${jdk.17.zip}" verbose="on" if:true="${os.windows}" unless:true="${jdk.17.zip.available}"/>
		<get src="${jdk.17.url.lin}" dest="${download.dir}/${jdk.17.zip}" verbose="on" if:true="${os.linux}" unless:true="${jdk.17.zip.available}"/>
		<get src="${jdk.17.url.mac}" dest="${download.dir}/${jdk.17.zip}" verbose="on" if:true="${os.mac}" unless:true="${jdk.17.zip.available}"/>
		<get src="${jdk.21.url.win}" dest="${download.dir}/${jdk.21.zip}" verbose="on" if:true="${os.windows}" unless:true="${jdk.21.zip.available}"/>
		<get src="${jdk.21.url.lin}" dest="${download.dir}/${jdk.21.zip}" verbose="on" if:true="${os.linux}" unless:true="${jdk.21.zip.available}"/>
		<get src="${jdk.21.url.mac}" dest="${download.dir}/${jdk.21.zip}" verbose="on" if:true="${os.mac}" unless:true="${jdk.21.zip.available}"/>
	</target>

	<target name="get.ant" unless="${ant.zip.available}">
		<get src="${ant.zip.url}" dest="${download.dir}/${ant.zip}" verbose="on" if:true="${os.windows}"/>
		<get src="${ant.gz.url}" dest="${download.dir}/${ant.gz}" verbose="on" unless:true="${os.windows}"/>
	</target>

	<target name="get.maven" unless="${maven.zip.available}">
		<get src="${maven.zip.url}" dest="${download.dir}/${maven.zip}" verbose="on" if:true="${os.windows}"/>
		<get src="${maven.gz.url}" dest="${download.dir}/${maven.gz}" verbose="on" unless:true="${os.windows}"/>
	</target>

	<target name="get.tomcat">
		<get src="${tomcat.9.url}" dest="${download.dir}/${tomcat.9.zip}" verbose="on" unless:true="${tomcat.9.zip.available}"/>
		<get src="${tomcat.10.url}" dest="${download.dir}/${tomcat.10.zip}" verbose="on" unless:true="${tomcat.10.zip.available}"/>
	</target>

	<target name="get.eclipse" unless="${eclipse.zip.available}" if="${eclipse}">
		<get src="${eclipse.url}" dest="${download.dir}/${eclipse.zip}" verbose="on"/>
	</target>

	<target name="get.lombok" unless="${lombok.jar.available}">
		<get src="${lombok.url}" dest="${download.dir}/${lombok.jar}" verbose="on"/>
	</target>

	<target name="get.winmerge" unless="${winmerge.zip.available}">
		<get src="${winmerge.url}" dest="${download.dir}/${winmerge.zip}" verbose="on"/>
	</target>

	<target name="get.ff" unless="${ff.war.available}">
		<get src="${ff.url}" dest="${download.dir}/${ff.war}" verbose="on" if:set="ff.version"/><!-- ff.version is not set when running maven -->
	</target>

	<target name="get.frankflow" unless="${frankflow.war.available}">
		<get src="${frankflow.url}" dest="${download.dir}/${frankflow.war}" verbose="on"/>
	</target>

	<target name="get.jta" unless="${jta.jar.available}">
		<get src="${jta.url}" dest="${download.dir}/${jta.jar}" verbose="on"/>
	</target>

	<target name="get.activation" unless="${activation.jar.available}">
		<get src="${activation.url}" dest="${download.dir}/${activation.jar}" verbose="on"/>
	</target>

	<target name="get.transaction" unless="${transaction.jar.available}">
		<get src="${transaction.url}" dest="${download.dir}/${transaction.jar}" verbose="on"/>
	</target>

	<target name="get.jms">
		<get src="${jms1.url}" dest="${download.dir}/${jms1.jar}" verbose="on" unless:true="${jms1.jar.available}"/>
		<get src="${jms3.url}" dest="${download.dir}/${jms3.jar}" verbose="on" unless:true="${jms3.jar.available}"/>
	</target>

	<target name="get.h2v1" unless="${h2v1.jar.available}">
		<get src="${h2v1.url}" dest="${download.dir}/${h2v1.jar}" verbose="on"/>
	</target>

	<target name="get.h2v2java8" unless="${h2v2java8.jar.available}">
		<get src="${h2v2java8.url}" dest="${download.dir}/${h2v2java8.jar}" verbose="on"/>
	</target>

	<target name="get.h2v2" unless="${h2v2.jar.available}">
		<get src="${h2v2.url}" dest="${download.dir}/${h2v2.jar}" verbose="on"/>
	</target>

	<target name="get.ojdbc">
		<get src="${ojdbc8.url}" dest="${download.dir}/${ojdbc8.jar}" verbose="on" unless:true="${ojdbc8.jar.available}"/>
		<get src="${ojdbc11.url}" dest="${download.dir}/${ojdbc11.jar}" verbose="on" unless:true="${ojdbc11.jar.available}"/>
	</target>

	<target name="get.mssql">
		<get src="${mssql8.url}" dest="${download.dir}/${mssql8.jar}" verbose="on" unless:true="${mssql8.jar.available}"/>
		<get src="${mssql11.url}" dest="${download.dir}/${mssql11.jar}" verbose="on" unless:true="${mssql11.jar.available}"/>
	</target>

	<target name="get.pgsql" unless="${pgsql.jar.available}">
		<get src="${pgsql.url}" dest="${download.dir}/${pgsql.jar}" verbose="on"/>
	</target>

	<target name="install.jdk">
		<available property="jdk.dir.available" file="${jdk.dir}"/>
		<unzip src="${download.dir}/${jdk.zip}" dest="build" unless:set="jdk.dir.available" if:true="${os.windows}">
			<patternset>
				<exclude name="**/demo"/>
				<exclude name="**/sample"/>
				<exclude name="**/src.zip"/>
			</patternset>
		</unzip>
		<mkdir dir="build" unless:set="jdk.dir.available" unless:true="${os.windows}"/>
		<gunzip src="${download.dir}/${jdk.zip}" dest="build" unless:set="jdk.dir.available" unless:true="${os.windows}"/>
		<property name="jdk.untar.fileset.dir" value="${jdk.sub.mac}" if:true="${os.mac}"/>
		<property name="jdk.untar.fileset.dir" value="."/>
		<untar src="build/${jdk.tar}" dest="${jdk.dir}" unless:set="jdk.dir.available" unless:true="${os.windows}">
			<patternset>
				<include name="**/${jdk.sub.mac}/**" if:true="${os.mac}"/>
				<exclude name="**/demo"/>
				<exclude name="**/sample"/>
				<exclude name="**/src.zip"/>
			</patternset>
			<cutdirsmapper dirs="1" unless:true="${os.mac}"/>
			<cutdirsmapper dirs="3" if:true="${os.mac}"/>
		</untar>
		<delete file="build/${jdk.tar}" unless:set="jdk.dir.available" unless:true="${os.windows}"/>
		<chmod dir="${jdk.dir}" includes="bin/*,${jdk.lib.jspawnhelper}" perm="+x" unless:set="jdk.dir.available" unless:true="${os.windows}"/>
		<antcall target="install.cacerts"/>
	</target>

	<target name="install.cacerts">
		<property name="cacerts.dir" value="lib/security"/>
		<condition property="copy.cacerts">
			<and>
				<resourceexists><file file="${jdk.dir}/${cacerts.dir}/cacerts"/></resourceexists><!-- when upgrading jdk, the new jdk folder doesn't exist yet when this target is called from the init target -->
				<not><resourceexists><file file="${jdk.dir}/${cacerts.dir}/cacerts-orig"/></resourceexists></not><!-- the copy from cacerts-orig to cacerts later on will make the timestamp of cacerts newer and copied again on next run, hence this condition to prevent that -->
			</and>
		</condition>
		<copy file="${jdk.dir}/${cacerts.dir}/cacerts" tofile="${jdk.dir}/${cacerts.dir}/cacerts-orig" if:set="copy.cacerts"/>
		<pathconvert property="cacerts"><fileset dir="." includes="cacerts/*"/><flattenmapper/></pathconvert>
		<pathconvert property="cacerts.jdk"><fileset dir="." includes="${jdk.dir}/${cacerts.dir}/cacerts-custom/*"/><flattenmapper/></pathconvert><!-- whole path in includes prevents error when jdk dir not present -->
		<condition property="cacerts.changed">
			<and>
				<not><equals arg1="${cacerts}" arg2="${cacerts.jdk}"/></not>
				<resourceexists><file file="${jdk.dir}/${cacerts.dir}/cacerts-orig"/></resourceexists><!-- when upgrading jdk, the new jdk folder doesn't exist yet when this target is called from the init target -->
			</and>
		</condition>
		<copy file="${jdk.dir}/${cacerts.dir}/cacerts-orig" tofile="${jdk.dir}/${cacerts.dir}/cacerts" overwrite="true" if:set="cacerts.changed"/>
		<delete dir="${jdk.dir}/${cacerts.dir}/cacerts-custom" if:set="cacerts.changed"/>
		<apply executable="${jdk.dir}/bin/keytool" relative="true" vmlauncher="false" failonerror="true" if:set="cacerts.changed">
			<arg value="-noprompt"/>
			<arg value="-storepass"/>
			<arg value="changeit"/>
			<arg value="-importcert"/>
			<arg value="-alias"/>
			<targetfile/>
			<arg value="-keystore"/>
			<arg value="${jdk.dir}/${cacerts.dir}/cacerts"/>
			<arg value="-file"/>
			<srcfile/>
			<fileset dir="." includes="cacerts/*"/>
			<chainedmapper>
				<flattenmapper/>
				<regexpmapper  from="(.*)\.(.*)" to="\1"/>
			</chainedmapper>
		</apply>
		<copy todir="${jdk.dir}/${cacerts.dir}/cacerts-custom" if:set="cacerts.changed"><fileset dir="cacerts" includes="*"/></copy>
	</target>

	<target name="install.tomcat.9">
		<property name="tomcat.zip" value="${tomcat.9.zip}"/>
		<property name="tomcat.dir" value="${tomcat.9.dir}"/>
		<property name="tomcat.dir.available" value="${tomcat.9.dir.available}"/>
		<property name="activation.required" value="false"/><!-- all ff versions running on tomcat 9 include the activation jar in the webapp -->
		<property name="ojdbc.jar" value="${ojdbc8.jar}"/><!-- older ff versions run with jdk 8, hence ojdbc8 -->
		<property name="ojdbc.uninstall.mask" value="${ojdbc8.uninstall.mask}"/>
		<property name="mssql.jar" value="${mssql8.jar}"/><!-- older ff versions run with jdk 8, hence mssql8 -->
		<property name="mssql.uninstall.mask" value="${mssql8.uninstall.mask}"/>
		<property name="jms.jar" value="${jms1.jar}"/>
		<property name="jms.uninstall.mask" value="${jms1.uninstall.mask}"/>
		<antcall target="install.tomcat.common"></antcall>
	</target>
	<target name="install.tomcat.10">
		<property name="tomcat.zip" value="${tomcat.10.zip}"/>
		<property name="tomcat.dir" value="${tomcat.10.dir}"/>
		<property name="tomcat.dir.available" value="${tomcat.10.dir.available}"/>
		<property name="activation.required" value="true"/><!-- frankframework-webapp-9.3.0-20250806.042330 was the last version to include the activation jar -->
		<property name="ojdbc.jar" value="${ojdbc11.jar}"/>
		<property name="ojdbc.uninstall.mask" value="${ojdbc11.uninstall.mask}"/>
		<property name="mssql.jar" value="${mssql11.jar}"/>
		<property name="mssql.uninstall.mask" value="${mssql11.uninstall.mask}"/>
		<property name="jms.jar" value="${jms3.jar}"/><!-- ff 8.2 requires jakarta instead of javax, hence jms3 -->
		<property name="jms.uninstall.mask" value="${jms3.uninstall.mask}"/>
		<antcall target="install.tomcat.common"></antcall>
	</target>
	<target name="install.tomcat.common">
		<unzip src="${download.dir}/${tomcat.zip}" dest="build" unless:true="${tomcat.dir.available}"/>
		<chmod dir="${tomcat.dir}/bin" includes="*.sh" perm="+x" unless:true="${tomcat.dir.available}"/>
		<delete includeemptydirs="true" unless:true="${tomcat.dir.available}"><fileset dir="${tomcat.dir}/webapps" includes="**/*"/></delete>
		<antcall target="install.library">
			<param name="library.jar" value="${jta.jar}"/>
			<param name="library.uninstall.mask" value="${jta.uninstall.mask}"/>
		</antcall>
		<antcall target="install.library" if:true="${activation.required}">
			<param name="library.jar" value="${activation.jar}"/>
			<param name="library.uninstall.mask" value="${activation.uninstall.mask}"/>
		</antcall>
		<antcall target="install.library">
			<param name="library.jar" value="${transaction.jar}"/><!-- prevent ClassNotFoundException when application.server.type.custom=NARAYANA is being used, see also https://github.com/frankframework/frankframework/blob/master/TESTING_WITH_IAF-TEST.md -->
			<param name="library.uninstall.mask" value="${transaction.uninstall.mask}"/>
		</antcall>
		<antcall target="install.library">
			<param name="library.jar" value="${jms.jar}"/>
			<param name="library.uninstall.mask" value="${jms.uninstall.mask}"/>
		</antcall>
		<antcall target="install.library">
			<param name="library.jar" value="${ojdbc.jar}"/>
			<param name="library.uninstall.mask" value="${ojdbc.uninstall.mask}"/>
		</antcall>
		<antcall target="install.library">
			<param name="library.jar" value="${mssql.jar}"/>
			<param name="library.uninstall.mask" value="${mssql.uninstall.mask}"/>
		</antcall>
		<antcall target="install.library">
			<param name="library.jar" value="${pgsql.jar}"/>
			<param name="library.uninstall.mask" value="${pgsql.uninstall.mask}"/>
		</antcall>
		<replaceregexp file="${tomcat.dir}/conf/server.xml" match="(Connector port=&quot;).*(&quot; protocol=&quot;HTTP)" replace="\1${tomcat.port}\2"/><!-- dont'use unless:true="${tomcat.dir.available}" because tomcat.port can be changed -->
		<replaceregexp file="${tomcat.dir}/conf/server.xml" match="(Connector port=&quot;).*(&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol)" replace="\1${tomcat.secure.port}\2"/><!-- dont'use unless:true="${tomcat.dir.available}" because tomcat.secure.port can be changed -->
		<replaceregexp file="${tomcat.dir}/conf/server.xml" match="(Server port=&quot;).*(&quot; shutdown)" replace="\1${tomcat.server.port}\2"/><!-- dont'use unless:true="${tomcat.dir.available}" because tomcat.secure.port can be changed -->
		<replaceregexp file="${tomcat.dir}/conf/server.xml" match="redirectPort=&quot;8443&quot;" replace="redirectPort=&quot;${tomcat.secure.port}&quot;"/><!-- dont'use unless:true="${tomcat.dir.available}" because tomcat.secure.port can be changed -->
		<replaceregexp file="${tomcat.dir}/conf/server.xml" match="&lt;!--(\s+.*org.apache.coyote.http11.Http11NioProtocol)" replace="\1" unless:true="${tomcat.dir.available}"/>
		<replaceregexp file="${tomcat.dir}/conf/server.xml" flags="s" match="(org.apache.coyote.http11.Http11NioProtocol.*?)-->" replace="\1" unless:true="${tomcat.dir.available}"/>
		<replaceregexp file="${tomcat.dir}/conf/tomcat-users.xml" match="&lt;/tomcat-users>" replace="  &lt;user username=&quot;IbisWebService&quot; password=&quot;IbisWebService&quot; roles=&quot;IbisWebService&quot;/>&#10;  &lt;user username=&quot;IbisObserver&quot; password=&quot;IbisObserver&quot; roles=&quot;IbisObserver&quot;/>&#10;  &lt;user username=&quot;IbisDataAdmin&quot; password=&quot;IbisDataAdmin&quot; roles=&quot;IbisDataAdmin&quot;/>&#10;  &lt;user username=&quot;IbisAdmin&quot; password=&quot;IbisAdmin&quot; roles=&quot;IbisAdmin&quot;/>&#10;  &lt;user username=&quot;IbisTester&quot; password=&quot;IbisTester&quot; roles=&quot;IbisTester&quot;/>&#10;&lt;/tomcat-users>" unless:true="${tomcat.dir.available}"/>
		<exec executable="${jdk.8.dir}/bin/keytool" vmlauncher="false" failonerror="true" unless:true="${tomcat.dir.available}">
			<arg value="-noprompt"/><arg value="-storepass"/><arg value="changeit"/><arg value="-keypass"/><arg value="changeit"/><arg value="-genkey"/><arg value="-alias"/><arg value="tomcat"/><arg value="-keyalg"/><arg value="RSA"/><arg value="-keystore"/><arg value="${tomcat.dir}/conf/localhost-rsa.jks"/><arg value="-storetype"/><arg value="pkcs12"/><arg value="-dname"/><arg value="CN=Frank"/>
		</exec>
		<replace file="${tomcat.dir}/conf/catalina.properties" token="jarsToSkip=\" value="jarsToSkip=*&#10;tomcat.util.scan.StandardJarScanFilter.jarsToSkip.OLD=\" summary="${debug.true}" unless:true="${tomcat.dir.available}"/><!-- speed up startup time -->
		<replace file="${tomcat.dir}/conf/catalina.properties" token="jarsToScan=\" value="jarsToScan=spring-web-*.jar,frankframework-*.jar,ibis-adapterframework-*.jar,frank-flow-*.jar,wearefrank__ladybug-*.jar,ladybug-frontend-*.jar,\" summary="${debug.true}" unless:true="${tomcat.dir.available}"/><!-- core jar needed for iaf/frankdoc (since https://github.com/ibissource/iaf/commit/2489369a052d046dba94adbcbcfea4428f0d12fd). See also https://www.webjars.org/documentation#servlet3 -->
		<replaceregexp file="${tomcat.dir}/conf/catalina.properties" match="\# \&lt;frank-runner\>.*\# \&lt;\/frank-runner\>" replace="" flags="sg"/>
		<concat destfile="${tomcat.dir}/conf/catalina.properties" append="true"># &lt;frank-runner>&#13;&#10;${system.properties}&#13;&#10;${configurations.properties}&#13;&#10;${tests.properties}&#13;&#10;&#13;&#10;# &lt;/frank-runner></concat>
		<replaceregexp file="${tomcat.dir}/conf/logging.properties" match="^org\.apache\.catalina\.core.ContainerBase\.\[Catalina\]\.\[localhost\]\.handlers\ " replace="# org.apache.catalina.core.ContainerBase.[Catalina].[localhost].handlers " flags="m"/><!-- some errors end up in localhost.<date>.log (e.g. when springIbisTestTool.xml is not correct), make them show up in the console -->
		<delete><fileset dir="${tomcat.dir}/lib" includes="**-CUSTOM.jar"/></delete>
		<available property="lib.server.dir.available" file="${projects.dir}/${project.dir}/${lib.server.dir}"/>
		<copy todir="${tomcat.dir}/lib" if:set="lib.server.dir.available"><fileset dir="${projects.dir}/${project.dir}/${lib.server.dir}"/><globmapper from="*.jar" to="*-CUSTOM.jar"/></copy>
	</target>
	<target name="install.library">
		<echo message="With library.jar=${library.jar}, library.uninstall.mask=${library.uninstall.mask} and tomcat.dir=${tomcat.dir}" if:set="debug.true"/>
		<available property="library.is.installed" filepath="${tomcat.dir}/lib" file="${library.jar}" searchparents="false"/>
		<echo message="library.is.installed=${library.is.installed}" if:set="debug.true"/>
		<delete unless:set="library.is.installed">
			<fileset dir="${tomcat.dir}/lib" includes="${library.uninstall.mask}"/>
		</delete>
		<copy file="${download.dir}/${library.jar}" todir="${tomcat.dir}/lib" unless:set="${library.is.installed}"/>
	</target>
	<target name="copy.config.xsd">
		<property name="dir2check" value="${dir}"/><!-- make dir the default value for dir2check -->
		<available property="dir2check.available" file="${dir2check}"/>
		<delete file="${dir}/FrankConfig.xsd" if:true="${dir2check.available}"/><!-- remove xsd when not available in current ff version -->
		<copy file="build/frankdoc/FrankConfig.xsd" todir="${dir}" failonerror="false" if:true="${dir2check.available}"/><!-- don't fail when xsd not available in current ff version, hence failonerror="false" -->
	</target>

	<target name="add.gitignore">
		<condition property="gitignore.add"><not><resourcecontains resource="${dir}/.gitignore" substring="${ignore}"/></not></condition>
		<condition property="gitignore.add.newline" if:true="${gitignore.add}"><length file="${dir}/.gitignore" when="greater" length="0"/></condition>
		<echo file="${dir}/.gitignore" message="&#10;" append="true" if:true="${gitignore.add.newline}"/>
		<echo file="${dir}/.gitignore" message="${ignore}" append="true" if:true="${gitignore.add}"/>
	</target>

	<target name="generate.bat">
		<condition property="ant"><equals arg1="${filename}" arg2="ant"/></condition>
		<condition property="mvn"><equals arg1="${filename}" arg2="mvn"/></condition>
		<condition property="env"><equals arg1="${filename}" arg2="env"/></condition>
		<condition property="cmd"><equals arg1="${filename}" arg2="cmd"/></condition>
		<condition property="ant.or.mvn"><or><isset property="ant"/><isset property="mvn"/></or></condition>
		<condition property="ant.or.mvn.or.env.or.cmd"><or><isset property="ant"/><isset property="mvn"/><isset property="env"/><isset property="cmd"/></or></condition>
		<condition property="mvn.or.env.or.cmd"><or><isset property="mvn"/><isset property="env"/><isset property="cmd"/></or></condition>
		<condition property="env.or.cmd"><or><isset property="env"/><isset property="cmd"/></or></condition>
		<echo file="${filename}.bat">:: This file is generated by build.xml
@echo off
setlocal enabledelayedexpansion
if not exist "%~dp0download\" (
	mkdir "%~dp0download"
)
if not exist "%~dp0build\tmp\build\" (
	mkdir "%~dp0build\tmp\build"
)</echo>
		<antcall target="generate.bat.download.unzip"><param name="zip" value="${fr.jdk.zip.win}"/><param name="url" value="${fr.jdk.url.win}"/><param name="dir.windows" value="${fr.jdk.dir.windows}"/><param name="run.install" value="true" if:set="mvn.or.env.or.cmd"/></antcall>
		<antcall target="generate.bat.download.unzip"><param name="zip" value="${ant.zip}"/><param name="url" value="${ant.zip.url}"/><param name="dir.windows" value="${ant.dir.windows}"/></antcall>
		<antcall target="generate.bat.download.unzip"><param name="zip" value="${rhino.zip}"/><param name="url" value="${rhino.zip.url}"/><param name="dir.windows" value="${rhino.dir.windows}"/></antcall>
		<echo file="${filename}.bat" append="true">
if not exist "%~dp0${ant.dir.windows}\lib\rhino-${rhino.version}.jar" (
	del "%~dp0${ant.dir.windows}\lib\rhino-*.jar"
	copy "%~dp0${rhino.dir.windows}\lib\rhino-*.jar" "%~dp0${ant.dir.windows}\lib\"
)
set JDK_8_DIR=%~dp0%${jdk.8.dir.windows}
set JDK_11_DIR=%~dp0%${jdk.11.dir.windows}
set JDK_17_DIR=%~dp0%${jdk.17.dir.windows}
set JDK_21_DIR=%~dp0%${jdk.21.dir.windows}</echo>
		<condition property="fr.use.jdk.8"><equals arg1="${fr.jdk.dir}" arg2="${jdk.8.dir}"/></condition>
		<echo file="${filename}.bat" append="true" if:set="ant.or.mvn.or.env.or.cmd" unless:set="fr.use.jdk.8">
if not exist "%JDK_8_DIR%" (
	set RUN_INSTALL=true
)</echo>
		<condition property="fr.use.jdk.11"><equals arg1="${fr.jdk.dir}" arg2="${jdk.11.dir}"/></condition>
		<echo file="${filename}.bat" append="true" if:set="ant.or.mvn.or.env.or.cmd" unless:set="fr.use.jdk.11">
if not exist "%JDK_11_DIR%" (
	set RUN_INSTALL=true
)</echo>
		<condition property="fr.use.jdk.17"><equals arg1="${fr.jdk.dir}" arg2="${jdk.17.dir}"/></condition>
		<echo file="${filename}.bat" append="true" if:set="ant.or.mvn.or.env.or.cmd" unless:set="fr.use.jdk.17">
if not exist "%JDK_17_DIR%" (
	set RUN_INSTALL=true
)</echo>
		<condition property="fr.use.jdk.21"><equals arg1="${fr.jdk.dir}" arg2="${jdk.21.dir}"/></condition>
		<echo file="${filename}.bat" append="true" if:set="ant.or.mvn.or.env.or.cmd" unless:set="fr.use.jdk.21">
if not exist "%JDK_21_DIR%" (
	set RUN_INSTALL=true
)</echo>
		<echo file="${filename}.bat" append="true" if:set="mvn.or.env.or.cmd">
if not exist "%~dp0${maven.dir.windows}" (
	set RUN_INSTALL=true
)</echo>
		<echo file="${filename}.bat" append="true" if:set="fr.use.jdk.8" unless:set="mvn">
set JAVA_HOME=%JDK_8_DIR%</echo>
		<echo file="${filename}.bat" append="true" if:set="fr.use.jdk.11" unless:set="mvn">
set JAVA_HOME=%JDK_11_DIR%</echo>
		<echo file="${filename}.bat" append="true" if:set="fr.use.jdk.17" unless:set="mvn">
set JAVA_HOME=%JDK_17_DIR%</echo>
		<echo file="${filename}.bat" append="true" if:set="fr.use.jdk.21" unless:set="mvn">
set JAVA_HOME=%JDK_21_DIR%</echo>
		<echo file="${filename}.bat" append="true" if:set="mvn">
rem ${maven.remark.line1}
rem ${maven.remark.line2}
set JAVA_HOME=%JDK_${mvn.jdk.version}_DIR%</echo>
		<echo file="${filename}.bat" append="true">
set ANT_HOME=%~dp0${ant.dir.windows}</echo><!-- prevent problems on systems with ant installed (e.g. when ANT_HOME points to an old ant version that version will be used which might not support all tasks and attributes) -->
		<!-- MAVEN_HOME isn't needed: https://stackoverflow.com/questions/26609922/maven-home-mvn-home-or-m2-home -->
		<echo file="${filename}.bat" append="true" if:set="ant.or.mvn.or.env.or.cmd">
if "%RUN_INSTALL%" == "true" (
	call "%~dp0${ant.dir.windows}\bin\ant" -emacs -buildfile "%~dp0build.xml" install
)</echo>
		<echo file="${filename}.bat" append="true" unless:set="env.or.cmd">
call "%~dp0</echo>
		<echo file="${filename}.bat" append="true" unless:set="mvn.or.env.or.cmd">${ant.dir.windows}\bin\ant" -Dfr.jdk.8.dir="%JDK_8_DIR%" -Dfr.jdk.11.dir="%JDK_11_DIR%" -Dfr.jdk.17.dir="%JDK_17_DIR%" -Dfr.jdk.21.dir="%JDK_21_DIR%" -emacs</echo><!-- -emacs will prevent prefix being added to every line of output -->
		<echo file="${filename}.bat" append="true" if:set="mvn">${maven.dir.windows}\bin\mvn.cmd"</echo>
		<echo file="${filename}.bat" append="true" unless:set="ant.or.mvn.or.env.or.cmd"> -buildfile "%~dp0build.xml"</echo>
		<echo file="${filename}.bat" append="true" unless:set="env.or.cmd"> %*</echo>
		<echo file="${filename}.bat" append="true" unless:set="ant.or.mvn.or.env.or.cmd"> ${filename}</echo>
		<echo file="${filename}.bat" append="true" if:set="env.or.cmd">
set PATH=%JAVA_HOME%\bin;%ANT_HOME%\bin;%~dp0${maven.dir.windows}\bin;%PATH%</echo>
		<echo file="${filename}.bat" append="true" if:set="env">
echo JAVA : %JAVA_HOME%
echo ANT  : %ANT_HOME%
echo MAVEN: %~dp0${maven.dir.windows}</echo>
		<echo file="${filename}.bat" append="true" if:set="cmd">
C:\Windows\System32\cmd.exe /k "echo JAVA : %JAVA_HOME%&amp; echo ANT  : %ANT_HOME%&amp; echo MAVEN: %~dp0${maven.dir.windows}"</echo><!-- complete path to prevent cmd.bat from recursively calling itself -->
		<echo file="${filename}.bat" append="true" unless:set="env.or.cmd">
if %errorlevel% equ 0 goto end
:error
rem https://superuser.com/questions/527898/how-to-pause-only-if-executing-in-a-new-window
set arg0=%0
if [%arg0:~2,1%]==[:] if not [%TERM_PROGRAM%] == [vscode] pause
exit /b %errorlevel%<!-- this will make failonerror="true" work when the bat file is called from ant with the exec task -->
:end
</echo>
		<echo file="${filename}.bat" append="true" if:set="env">
endlocal &amp; SET JAVA_HOME=%JAVA_HOME% &amp; SET ANT_HOME=%ANT_HOME% &amp; SET PATH=%PATH%<!-- https://stackoverflow.com/questions/3262287/make-an-environment-variable-survive-endlocal -->
</echo>
	</target>

	<target name="generate.sh">
		<condition property="ant"><equals arg1="${filename}" arg2="ant"/></condition>
		<condition property="mvn"><equals arg1="${filename}" arg2="mvn"/></condition>
		<condition property="env"><equals arg1="${filename}" arg2="env"/></condition>
		<condition property="ant.or.mvn"><or><isset property="ant"/><isset property="mvn"/></or></condition>
		<condition property="ant.or.mvn.or.env"><or><isset property="ant"/><isset property="mvn"/><isset property="env"/></or></condition>
		<condition property="mvn.or.env"><or><isset property="mvn"/><isset property="env"/></or></condition>
		<echo file="${filename}.sh">#!/bin/bash
# This file is generated by build.xml
if [[ "${BASH_SOURCE%/*}" == "." || "${BASH_SOURCE%/*}" == */* ]]; then
  FR_DIR="`pwd`/$${BASH_SOURCE%/*}/"
else
  # No ./ or /path/to/ being used but for example 'bash restart.sh' or 'source env.sh' (instead of 'source ./env.sh' or 'source /path/to/env.sh')
  FR_DIR="`pwd`/"
fi
if [[ $${BASH_SOURCE:0:1} == "/" ]]; then
  # Workaround for VSCode Task Explorer on Mac and Linux
  FR_DIR="$${BASH_SOURCE%/*}/"
fi
if [[ ! -d "$${FR_DIR}download/" ]]; then
	mkdir "$${FR_DIR}download/"
fi
if [[ ! -d "$${FR_DIR}build/tmp/build" ]]; then
	mkdir -p "$${FR_DIR}build/tmp/build"
fi</echo>
		<antcall target="generate.sh.download.unzip"><param name="zip" value="${fr.jdk.zip.lin}"/><param name="zip.mac" value="${fr.jdk.zip.mac}"/><param name="url" value="${fr.jdk.url.lin}"/><param name="url.mac" value="${fr.jdk.url.mac}"/><param name="dir" value="${fr.jdk.dir}"/><param name="sub.mac" value="${jdk.sub.mac}"/><param name="run.chmod.jspawnhelper" value="true"/><param name="run.install" value="true" if:set="mvn.or.env"/></antcall>
		<antcall target="generate.sh.download.unzip"><param name="zip" value="${ant.gz}"/><param name="url" value="${ant.gz.url}"/><param name="dir" value="${ant.dir}"/></antcall>
		<antcall target="generate.sh.download.unzip"><param name="zip" value="${rhino.zip}"/><param name="url" value="${rhino.zip.url}"/><param name="dir" value="${rhino.dir}"/></antcall>
		<echo file="${filename}.sh" append="true">
if [[ ! -f "${FR_DIR}${ant.dir}/lib/rhino-${rhino.version}.jar" ]]; then
	rm "${FR_DIR}${ant.dir}/lib/rhino-"*.jar
	cp "${FR_DIR}${rhino.dir}/lib/rhino-"*.jar "${FR_DIR}${ant.dir}/lib/"
fi
JDK_8_DIR="$${FR_DIR}${jdk.8.dir}"
JDK_11_DIR="$${FR_DIR}${jdk.11.dir}"
JDK_17_DIR="$${FR_DIR}${jdk.17.dir}"
JDK_21_DIR="$${FR_DIR}${jdk.21.dir}"</echo>
		<condition property="fr.use.jdk.8"><equals arg1="${fr.jdk.dir}" arg2="${jdk.8.dir}"/></condition>
		<echo file="${filename}.sh" append="true" if:set="ant.or.mvn.or.env" unless:set="fr.use.jdk.8">
if [[ ! -d "$${JDK_8_DIR}" ]]; then
	RUN_INSTALL="true"
fi</echo>
		<condition property="fr.use.jdk.11"><equals arg1="${fr.jdk.dir}" arg2="${jdk.11.dir}"/></condition>
		<echo file="${filename}.sh" append="true" if:set="ant.or.mvn.or.env" unless:set="fr.use.jdk.11">
if [[ ! -d "$${JDK_11_DIR}" ]]; then
	RUN_INSTALL="true"
fi</echo>
		<condition property="fr.use.jdk.17"><equals arg1="${fr.jdk.dir}" arg2="${jdk.17.dir}"/></condition>
		<echo file="${filename}.sh" append="true" if:set="ant.or.mvn.or.env" unless:set="fr.use.jdk.17">
if [[ ! -d "$${JDK_17_DIR}" ]]; then
	RUN_INSTALL="true"
fi</echo>
		<condition property="fr.use.jdk.21"><equals arg1="${fr.jdk.dir}" arg2="${jdk.21.dir}"/></condition>
		<echo file="${filename}.sh" append="true" if:set="ant.or.mvn.or.env" unless:set="fr.use.jdk.21">
if [[ ! -d "$${JDK_21_DIR}" ]]; then
	RUN_INSTALL="true"
fi</echo>
		<echo file="${filename}.sh" append="true" if:set="mvn.or.env">
if [[ ! -d "$${FR_DIR}${maven.dir}" ]]; then
	RUN_INSTALL="true"
fi</echo>
		<echo file="${filename}.sh" append="true" if:set="fr.use.jdk.8" unless:set="mvn">
export JAVA_HOME="$${JDK_8_DIR}"</echo>
		<echo file="${filename}.sh" append="true" if:set="fr.use.jdk.11" unless:set="mvn">
export JAVA_HOME="$${JDK_11_DIR}"</echo>
		<echo file="${filename}.sh" append="true" if:set="fr.use.jdk.17" unless:set="mvn">
export JAVA_HOME="$${JDK_17_DIR}"</echo>
		<echo file="${filename}.sh" append="true" if:set="fr.use.jdk.21" unless:set="mvn">
export JAVA_HOME="$${JDK_21_DIR}"</echo>
		<echo file="${filename}.sh" append="true" if:set="mvn">
# ${maven.remark.line1}
# ${maven.remark.line2}
export JAVA_HOME="$${JDK_${mvn.jdk.version}_DIR}"</echo>
		<echo file="${filename}.sh" append="true">
export ANT_HOME="$${FR_DIR}${ant.dir}"</echo><!-- prevent problems on systems with ant installed (e.g. when ANT_HOME points to an old ant version that version will be used which might not support all tasks and attributes) -->
		<!-- MAVEN_HOME isn't needed: https://stackoverflow.com/questions/26609922/maven-home-mvn-home-or-m2-home -->
		<echo file="${filename}.sh" append="true" if:set="ant.or.mvn.or.env">
if [[ "$RUN_INSTALL" == "true" ]]; then
	"$${FR_DIR}${ant.dir}/bin/ant" -emacs -buildfile "$${FR_DIR}build.xml" install
fi</echo>
		<echo file="${filename}.sh" append="true" unless:set="env">
"$${FR_DIR}</echo>
		<echo file="${filename}.sh" append="true" unless:set="mvn.or.env">${ant.dir}/bin/ant" -Dfr.jdk.8.dir="$${JDK_8_DIR}" -Dfr.jdk.11.dir="$${JDK_11_DIR}" -Dfr.jdk.17.dir="$${JDK_17_DIR}" -Dfr.jdk.21.dir="$${JDK_21_DIR}" -emacs</echo><!-- -emacs will prevent prefix being added to every line of output -->
		<echo file="${filename}.sh" append="true" if:set="mvn">${maven.dir}/bin/mvn"</echo>
		<echo file="${filename}.sh" append="true" unless:set="ant.or.mvn.or.env"> -buildfile "$${FR_DIR}build.xml"</echo>
		<echo file="${filename}.sh" append="true" unless:set="env"> "$$@"</echo>
		<echo file="${filename}.sh" append="true" unless:set="ant.or.mvn.or.env"> ${filename}</echo>
		<echo file="${filename}.sh" append="true" if:set="env">
export PATH="$${JAVA_HOME}/bin:$${ANT_HOME}/bin:$${FR_DIR}${maven.dir}/bin:$${PATH}"
echo "JAVA : $${JAVA_HOME}"
echo "ANT  : $${ANT_HOME}"
echo "MAVEN: $${FR_DIR}${maven.dir}"
</echo>
		<chmod file="${filename}.sh" perm="+x"/>
	</target>

	<target name="generate.bat.download.unzip">
		<echo file="${filename}.bat" append="true">
set DOWNLOAD_HELP=download ${url} manually, move it to %~dp0download and restart this script
if not exist "%~dp0download\${zip}" (
	echo "In case of errors %DOWNLOAD_HELP%"
	curl -f -o "%~dp0download\${zip}.tmp" -L ${url}<!-- -f will set errorlevel and prevent html being written to output file when for example html with an error message and http status code 404 is returned -->
	if !errorlevel! neq 0 (<!-- cannot use %errorlevel% in a block statement: https://stackoverflow.com/questions/35164750/windows-batch-errorlevel-with-if -->
		echo "Please %DOWNLOAD_HELP%"
		goto error
	)
	move "%~dp0download\${zip}.tmp" "%~dp0download\${zip}"
)
if not exist "%~dp0${dir.windows}\" (
	tar --exclude=*/demo --exclude=*/sample --exclude=*/manual --exclude=*/src.zip -xvf "%~dp0download\${zip}" -C "%~dp0build\tmp\build"
	if !errorlevel! neq 0 (<!-- cannot use %errorlevel% in a block statement: https://stackoverflow.com/questions/35164750/windows-batch-errorlevel-with-if -->
		echo "Please %DOWNLOAD_HELP%"<!-- when a proxy replaces the content of the zip with an html page saying access is denied curl doesn't notice it and an error occurs when unzipping, hence the user also needs instruction to download manually when unzip fails -->
		goto error
	)
	move "%~dp0build\tmp\${dir.windows}" "%~dp0${dir.windows}"</echo><echo file="${filename}.bat" append="true" if:true="${run.install}">
	RUN_INSTALL="true"<!-- install cacerts when present --></echo><echo file="${filename}.bat" append="true">
)</echo>
	</target>

	<target name="generate.sh.download.unzip">
		<condition property="unzip"><contains string="${zip}" substring=".zip"/></condition>
		<echo file="${filename}.sh" append="true">
ZIP=${zip}
URL=${url}
DIR=${dir}
SUB=</echo><echo file="${filename}.sh" append="true" if:set="zip.mac">
if [[ "$$OSTYPE" == "darwin"* ]]; then
	ZIP=${zip.mac}
	URL=${url.mac}
	SUB=${sub.mac}
fi</echo><echo file="${filename}.sh" append="true">
DOWNLOAD_HELP="download $${URL} manually, move it to $${FR_DIR}download and restart this script"
if [[ ! -f "$${FR_DIR}download/$${ZIP}" ]]; then
	echo In case of errors $${DOWNLOAD_HELP}
	curl -f -o "$${FR_DIR}download/$${ZIP}.tmp" -L $${URL}<!-- -f will return error 22 and prevent html being written to output file when for example html with an error message and http status code 404 is returned -->
	retVal=$$?
	if [[ $$retVal -ne 0 ]]; then
		echo "Please $${DOWNLOAD_HELP}"
		exit $$retVal
	fi
	mv "$${FR_DIR}download/$${ZIP}.tmp" "$${FR_DIR}/download/$${ZIP}"
fi
if [[ ! -d "$${FR_DIR}$${DIR}/" ]]; then</echo><echo file="${filename}.sh" append="true" unless:set="unzip">
	tar --exclude=*/demo --exclude=*/sample --exclude=*/manual --exclude=*/src.zip -xzvf "$${FR_DIR}download/$${ZIP}" -C "$${FR_DIR}build/tmp/build"</echo><echo file="${filename}.sh" append="true" if:set="unzip">
	unzip "$${FR_DIR}download/$${ZIP}" -d "$${FR_DIR}build/tmp/build"</echo><echo file="${filename}.sh" append="true">
	retVal=$$?
	if [[ $$retVal -ne 0 ]]; then
		echo "Please $${DOWNLOAD_HELP}"<!-- when a proxy replaces the content of the zip with an html page saying access is denied curl doesn't notice it and an error occurs when unzipping, hence the user also needs instruction to download manually when unzip fails -->
		exit $$retVal
	fi
	mv "$${FR_DIR}build/tmp/$${DIR}/$${SUB}" "$${FR_DIR}$${DIR}"</echo><echo file="${filename}.sh" append="true" if:true="${run.chmod.jspawnhelper}">
	chmod +x "$${FR_DIR}$${DIR}/${jdk.lib.jspawnhelper}"</echo><echo file="${filename}.sh" append="true" if:true="${run.install}">
	RUN_INSTALL="true"<!-- install cacerts when present --></echo><echo file="${filename}.sh" append="true">
fi</echo>
	</target>

	<target name="splash">
		<echo message="main.project: ${main.project}" if:set="debug.true"/>
		<echo message="sub.project: ${sub.project}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/><!-- space instead of empty for eclipse -->
		<echo message="projects.dir: ${projects.dir}" if:set="debug.true"/>
		<echo message="project.dir: ${project.dir}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="modules.dir: ${modules.dir}" if:set="debug.true"/>
		<echo message="module.dir: ${module.dir}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="war.dir: ${war.dir}" if:set="debug.true"/>
		<echo message="application.war.pom.xml.available: ${application.war.pom.xml.available}" if:set="debug.true"/>
		<echo message="war.pom.xml.available: ${war.pom.xml.available}" if:set="debug.true"/>
		<echo message="pom.xml.available: ${pom.xml.available}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="classes.dir: ${classes.dir}" if:set="debug.true"/>
		<echo message="configurations.dir: ${configurations.dir}" if:set="debug.true"/>
		<echo message="java.dir: ${java.dir}" if:set="debug.true"/>
		<echo message="tests.dir: ${tests.dir}" if:set="debug.true"/>
		<echo message="resources.yml.available: ${resources.yml.available}" if:set="debug.true"/>
		<echo message="maven.exec.dir: ${maven.exec.dir}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="maven: ${maven}" if:set="debug.true"/>
		<echo message="maven.phase: ${maven.phase}" if:set="debug.true"/>
		<echo message="maven.skip.clean: ${maven.skip.clean}" if:set="debug.true"/>
		<echo message="maven.skip.tests: ${maven.skip.tests}" if:set="debug.true"/>
		<echo message="maven.skip.javadoc: ${maven.skip.javadoc}" if:set="debug.true"/>
		<echo message="maven.verbose: ${maven.verbose}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="classloader.type: ${classloader.type}" if:set="debug.true"/>
		<echo message="lib.server.dir: ${lib.server.dir}" if:set="debug.true"/>
		<echo message="lib.webapp.dir: ${lib.webapp.dir}" if:set="debug.true"/>
		<echo message="database.type: ${database.type}" if:set="debug.true"/>
		<echo message="dtap.stage: ${dtap.stage}" if:set="debug.true"/>
		<echo message="otap.stage: ${otap.stage}" if:set="debug.true"/>
		<echo message="ds.properties.instance.name: ${ds.properties.instance.name}" if:set="debug.true"/>
		<echo message="ds.properties.configurations.names: ${ds.properties.configurations.names}" if:set="debug.true"/>
		<echo message="instance.name: ${instance.name}" if:set="debug.true"/>
		<echo message="instance.name.lc: ${instance.name.lc}" if:set="debug.true"/>
		<echo message="ibistesttool.directory: ${ibistesttool.directory}" if:set="debug.true"/>
		<echo message="larva.windiff.command: ${larva.windiff.command}" if:set="debug.true"/>
		<echo message="context.path: ${context.path}" if:set="debug.true"/>
		<echo message="maxmemory: ${maxmemory}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="update.strategy: ${update.strategy}" if:set="debug.true"/>
		<echo message="ff.version: ${ff.version}" if:set="debug.true"/>
		<echo message="h2.jar: ${h2.jar}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="webapp.dir: ${webapp.dir}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="system.properties:${system.properties}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="configurations.dirset.dir=${configurations.dirset.dir}" if:set="debug.true"/>
		<echo message="configurations.dir.abs=${configurations.dir.abs}" if:set="debug.true"/>
		<echo message="configurations.dir.rel=${configurations.dir.rel}" if:set="debug.true"/>
		<echo message="configurations.dirset.includes=${configurations.dirset.includes}" if:set="debug.true"/>
		<echo message="configurations.dirs.flat=${configurations.dirs.flat}" if:set="debug.true"/>
		<echo message="configurations.properties:${configurations.properties}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="projects.dir.abs=${projects.dir.abs}" if:set="debug.true"/>
		<echo message="scenariosroot.default=${scenariosroot.default}" if:set="debug.true"/>
		<echo message="tests.dirset.dir=${tests.dirset.dir}" if:set="debug.true"/>
		<echo message="tests.dir.abs=${tests.dir.abs}" if:set="debug.true"/>
		<echo message="tests.dir.rel=${tests.dir.rel}" if:set="debug.true"/>
		<echo message="tests.dirset.includes=${tests.dirset.includes}" if:set="debug.true"/>
		<echo message="tests.properties:${tests.properties}" if:set="debug.true"/>
		<echo message=" " if:set="debug.true"/>
		<echo message="    https://github.com/ibissource/frank-runner#frankrunner" if:set="debug.true"/>
		<!-- http://www.network-science.de/ascii/ font standard -->
		<echo message="     _____                _    _ ____"/>
		<echo message="    |  ___| __ __ _ _ __ | | _| |  _ \ _   _ _ __  _ __   ___ _ __"/>
		<echo message="    | |_ | '__/ _` | '_ \| |/ / | |_) | | | | '_ \| '_ \ / _ \ '__|"/>
		<echo message="    |  _|| | | (_| | | | |   &lt;|_|  _ &lt;| |_| | | | | | | |  __/ |"/>
		<echo message="    |_|  |_|  \__,_|_| |_|_|\_(_)_| \_\\__,_|_| |_|_| |_|\___|_|"/>
		<echo message=" "/>
		<property name="splash.name" value="${main.project}_${sub.project}" if:set="sub.project"/>
		<property name="splash.name" value="${instance.name} ${module.dir}" if:set="module.dir"/>
		<property name="splash.name" value="${instance.name}"/>
		<condition property="splash.port" value="" else=":${tomcat.port}"><equals arg1="${tomcat.port}" arg2="80"/></condition>
		<condition property="splash.context" value="" else="${context.path}"><equals arg1="${context.path}" arg2="ROOT"/></condition>
		<echo message="    Frank!Framework ${ff.pom.properties.version} running ${splash.name} on http://localhost${splash.port}/${splash.context}"/><!-- ff.pom.properties.version instead of ff.version for correct value when maven is used -->
		<echo message=" "/>
		<echo message="    Frank!Flow ${frankflow.version} on http://localhost${splash.port}/frank-flow/"/>
		<echo message=" "/>
		<echo message=" " unless:set="frank.runner.up.to.date"/>
		<echo message="    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!" unless:set="frank.runner.up.to.date"/>
		<echo message="    !! Your Frank!Runner is out of date, please pull or download new version !!" unless:set="frank.runner.up.to.date"/>
		<echo message="    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!" unless:set="frank.runner.up.to.date"/>
		<echo message=" " if:set="double.jars"/>
		<echo message="    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! WARNING !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!" if:set="double.jars"/>
		<echo message="    The following double jars are found: ${double.jars}" if:set="double.jars"/>
		<echo message="    In folder ${webapp.dir}/WEB-INF/lib" if:set="double.jars"/>
		<echo message="    Possible solutions / causes:" if:set="double.jars"/>
		<echo message="    - When maven=true disable maven.skip.clean=true (when present) at least once." if:set="double.jars"/>
		<echo message="    - Check your pom.xml for dependencies already present in the framework war." if:set="double.jars"/>
		<echo message="    - Add framework core jar to your pom.xml (Maven doesn't add jar files inside a" if:set="double.jars"/>
		<echo message="      war file to the dependency tree to resolve dependency conflicts)." if:set="double.jars"/>
		<echo message="    - Add maven-war-plugin or ibis-war-plugin (when" if:set="double.jars"/>
		<echo message="      https://github.com/ibissource/ibis-war-plugin/issues/1 is closed) with" if:set="double.jars"/>
		<echo message="      excludes like &lt;exclude>WEB-INF/lib/example-*.jar&lt;/exclude>." if:set="double.jars"/>
		<echo message="    - The framework war might contain a duplicate jar which should be reported as a" if:set="double.jars"/>
		<echo message="      bug (when an artifact changes it's groupid between versions Maven will not" if:set="double.jars"/>
		<echo message="      detect it to be a duplicate jar when one transitive dependency has the old" if:set="double.jars"/>
		<echo message="      one and another has the new one so one of them has to be excluded in the" if:set="double.jars"/>
		<echo message="      framework pom.xml)." if:set="double.jars"/>
		<echo message="    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! WARNING !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!" if:set="double.jars"/>
	</target>

	<scriptdef language="javascript" name="lower">
		<attribute name="from"/> 
		<attribute name="to"/>
		project.setProperty(attributes.get("to"), attributes.get("from").toLowerCase());
	</scriptdef>

	<scriptdef language="javascript" name="doublejars">
		<attribute name="jars"/>
		var jars = new String(attributes.get("jars")).split('|');
		var doubleJars = '';
		var names = [];
		for (var i = 0; i &lt; jars.length; i++) {
			var name = '';
			var j = jars[i].indexOf('-');
			var k = 0;
			while (j != -1) {
				// Double jars: ibis-ladybug-2.2.jar ibis-ladybug-2.2-SNAPSHOT.jar
				// Unique jars: ibis-ladybug-2.2.jar ibis-ladybug-2.2-SNAPSHOT-tests.jar ibis-ladybug-2.2-tests.jar
				if ((jars[i].charAt(k) &lt; '0' || jars[i].charAt(k) &gt; '9')
						&amp;&amp; jars[i].substring(k, j) != 'SNAPSHOT'
						&amp;&amp; jars[i].substring(k, j) != 'CUSTOM') {
					if (k != 0) {
						name += '-';
					}
					name += jars[i].substring(k, j);
				}
				k = j + 1;
				j = jars[i].indexOf('-', k);
				if (j == -1) {
					j = jars[i].indexOf('.jar', k);
				}
			}
			// Ignore annotations-2.18.1.jar and annotations-13.0.jar that have different groupId's
			// Ignore icu4j: https://github.com/frankframework/frankframework/issues/7002
			if (names.indexOf(name) != -1 &amp;&amp; name != 'annotations' &amp;&amp; name != 'icu4j') {
				if (doubleJars.length == 0) {
					doubleJars = name;
				} else {
					doubleJars += ', ' + name;
				}
			}
			names.push(name);
		}
		if (doubleJars.length > 0) {
			project.setProperty('double.jars', doubleJars);
		}
	</scriptdef>

</project>
